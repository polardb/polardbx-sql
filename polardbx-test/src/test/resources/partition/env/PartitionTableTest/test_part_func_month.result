DROP TABLE IF EXISTS tbl;
CREATE TABLE `tbl` (
	`a` datetime NOT NULL
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY RANGE (MONTH(a)) (
	PARTITION p1 VALUES LESS THAN (2)
		STORAGE ENGINE InnoDB,
	PARTITION p2 VALUES LESS THAN (3)
		STORAGE ENGINE InnoDB,
	PARTITION p3 VALUES LESS THAN (4)
		STORAGE ENGINE InnoDB,
	PARTITION p4 VALUES LESS THAN (5)
		STORAGE ENGINE InnoDB,
	PARTITION p5 VALUES LESS THAN (6)
		STORAGE ENGINE InnoDB,
	PARTITION p6 VALUES LESS THAN (7)
		STORAGE ENGINE InnoDB,
	PARTITION p7 VALUES LESS THAN (8)
		STORAGE ENGINE InnoDB,
	PARTITION p8 VALUES LESS THAN (9)
		STORAGE ENGINE InnoDB,
	PARTITION p9 VALUES LESS THAN (10)
		STORAGE ENGINE InnoDB,
	PARTITION p10 VALUES LESS THAN (11)
		STORAGE ENGINE InnoDB,
	PARTITION p11 VALUES LESS THAN (12)
		STORAGE ENGINE InnoDB,
	PARTITION p12 VALUES LESS THAN (13)
		STORAGE ENGINE InnoDB
);
SHOW CREATE TABLE tbl;
Table,Create Table
tbl,CREATE TABLE `tbl` (
	`a` datetime NOT NULL,
	KEY `auto_shard_key_a` USING BTREE (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY RANGE(MONTH(`a`))
(PARTITION p1 VALUES LESS THAN (2) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (3) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (4) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (5) ENGINE = InnoDB,
 PARTITION p5 VALUES LESS THAN (6) ENGINE = InnoDB,
 PARTITION p6 VALUES LESS THAN (7) ENGINE = InnoDB,
 PARTITION p7 VALUES LESS THAN (8) ENGINE = InnoDB,
 PARTITION p8 VALUES LESS THAN (9) ENGINE = InnoDB,
 PARTITION p9 VALUES LESS THAN (10) ENGINE = InnoDB,
 PARTITION p10 VALUES LESS THAN (11) ENGINE = InnoDB,
 PARTITION p11 VALUES LESS THAN (12) ENGINE = InnoDB,
 PARTITION p12 VALUES LESS THAN (13) ENGINE = InnoDB)
INSERT INTO tbl
VALUES ('1989-01-01 00:00:00');
INSERT INTO tbl
VALUES ('1990-01-01 00:00:01'),
	('1991-01-01 00:00:02'),
	('2019-01-01 00:00:03');
SELECT *
FROM tbl
WHERE a = '1989-01-01 00:00:00'
ORDER BY a;
a
1989-01-01 00:00:00.0
SELECT *
FROM tbl
WHERE a = '1990-01-01 00:00:01'
ORDER BY a;
a
1990-01-01 00:00:01.0
SELECT *
FROM tbl
WHERE a = '1991-01-01 00:00:02'
ORDER BY a;
a
1991-01-01 00:00:02.0
SELECT *
FROM tbl
WHERE a = '2019-01-01 00:00:03'
ORDER BY a;
a
2019-01-01 00:00:03.0
SELECT *
FROM tbl
WHERE (a < '2019-01-02 00:00:00'
		AND a >= '2009-12-31 00:00:00')
	OR a BETWEEN '1989-01-01 00:00:00' AND '1989-11-01 00:00:00'
ORDER BY a;
a
1989-01-01 00:00:00.0
2019-01-01 00:00:03.0
EXPLAIN SELECT *
FROM tbl
WHERE a = '2000-01-01 00:00:00'
ORDER BY a;
Logical ExecutionPlan
LogicalView(tables="tbl[p1]", sql="SELECT `a` FROM `tbl` AS `tbl` WHERE (`a` = ?) ORDER BY `a`")
EXPLAIN SELECT *
FROM tbl
WHERE (a <= '2019-01-01 00:00:00'
		AND a >= '2018-12-31 23:59:59')
	OR a BETWEEN '1989-01-01 00:00:00' AND '1989-05-31 23:59:59'
ORDER BY a;
Logical ExecutionPlan
MergeSort(sort="a ASC")
  LogicalView(tables="tbl[p1,p2,p3,p4,p5,p12]", shardCount=6, sql="SELECT `a` FROM `tbl` AS `tbl` WHERE (((`a` <= ?) AND (`a` >= ?)) OR (`a` BETWEEN ? AND ?)) ORDER BY `a`")
EXPLAIN SELECT *
FROM tbl
WHERE a BETWEEN date_format('2008-08-08 22:23:01', '%Y-%m-%d 01:01:01') AND date_format('2008-12-08 22:23:01', '%Y-%m-%d 01:01:01')
ORDER BY a;
Logical ExecutionPlan
MergeSort(sort="a ASC")
  LogicalView(tables="tbl[p8,p9,p10,p11,p12]", shardCount=5, sql="SELECT `a` FROM `tbl` AS `tbl` WHERE (`a` BETWEEN (DATE_FORMAT(?, '%Y-%m-%d 01:01:01')) AND DATE_FORMAT(?, '%Y-%m-%d 01:01:01')) ORDER BY `a`")
DROP TABLE IF EXISTS t1;
CREATE TABLE `t1` (
	`id` bigint(20) NOT NULL AUTO_INCREMENT,
	`dt` datetime DEFAULT NULL,
	PRIMARY KEY (`id`)
) ENGINE = InnoDB
PARTITION BY HASH (MONTH(`dt`)) PARTITIONS 3;
EXPLAIN SELECT *
FROM t1
WHERE dt = '2021-09-12 18:00:01';
Logical ExecutionPlan
LogicalView(tables="t1[p1]", sql="SELECT `id`, `dt` FROM `t1` AS `t1` WHERE (`dt` = ?)")
SELECT part_route('', 't1', '2021-09-12 18:00:01');
part_route('', 't1', '2021-09-12 18:00:01')
p1
INSERT INTO t1
VALUES (1, '2021-09-12 18:00:01');
SELECT *
FROM t1
WHERE dt = '2021-09-12 18:00:01';
id,dt
1,2021-09-12 18:00:01.0
SELECT part_route('', 't1', dt) AS part
FROM t1;
part
p1
DROP TABLE IF EXISTS tbl_month;
CREATE TABLE tbl_month (
	id int,
	tm date
)
PARTITION BY RANGE (month(tm)) (
	PARTITION p0 VALUES LESS THAN (3),
	PARTITION p1 VALUES LESS THAN (6),
	PARTITION pd VALUES LESS THAN MAXVALUE
);
INSERT INTO tbl_month
VALUES (0, '20220201');
INSERT INTO tbl_month
VALUES (0, '20220301');
INSERT INTO tbl_month
VALUES (0, '20220601');
SELECT *
FROM tbl_month
ORDER BY tm;
id,tm
0,2022-02-01
0,2022-03-01
0,2022-06-01
SELECT *
FROM tbl_month
WHERE tm < '2022-03-02'
ORDER BY tm;
id,tm
0,2022-02-01
0,2022-03-01
SELECT *
FROM tbl_month
WHERE tm <= '2022-03-02'
ORDER BY tm;
id,tm
0,2022-02-01
0,2022-03-01
SELECT *
FROM tbl_month
WHERE tm < '2022-03-01'
ORDER BY tm;
id,tm
0,2022-02-01
SELECT *
FROM tbl_month
WHERE tm <= '2022-03-01'
ORDER BY tm;
id,tm
0,2022-02-01
0,2022-03-01
SELECT *
FROM tbl_month
WHERE tm < '2022-03-01'
	AND tm >= '2022-02-01'
ORDER BY tm;
id,tm
0,2022-02-01
CREATE TABLE list_month (
	dt date
)
PARTITION BY LIST (month(dt)) (
	PARTITION p1 VALUES IN (1),
	PARTITION p2 VALUES IN (2),
	PARTITION pd VALUES IN (3)
);
INSERT INTO list_month
VALUES ('20210101'),
	('20220101'),
	('20220201'),
	('20220301');
SELECT *
FROM list_month
WHERE dt <= '20230101'
ORDER BY dt;
dt
2021-01-01
2022-01-01
2022-02-01
2022-03-01