## DISABLE_FAST_SQL_PARSER
create tablegroup tg1;
CREATE TABLE `t2` (
  `a` varchar(8) DEFAULT NULL,
  `b` varchar(16) DEFAULT NULL,
  `c` varchar(32) DEFAULT NULL,
  `d` int(11) DEFAULT NULL
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`) PARTITIONS 4 (
PARTITION p1 VALUES LESS THAN (1000,9223372036854775807),
PARTITION p2 VALUES LESS THAN (2000,9223372036854775807),
PARTITION p3 VALUES LESS THAN (3000,9223372036854775807),
PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807)
)
tablegroup = tg1;
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t2;
Table,Create Table
t2,CREATE TABLE `t2` (
	`a` varchar(8) DEFAULT NULL,
	`b` varchar(16) DEFAULT NULL,
	`c` varchar(32) DEFAULT NULL,
	`d` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`)
PARTITIONS 4
(PARTITION p1 VALUES LESS THAN (1000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (2000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
tablegroup = `tg1`
CREATE TABLE `t3` (
  `a` varchar(8) DEFAULT NULL,
  `b` varchar(16) DEFAULT NULL,
  `c` varchar(32) DEFAULT NULL,
  `d` int(11) DEFAULT NULL
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`,`c`) PARTITIONS 4 (
PARTITION p1 VALUES LESS THAN (1000,9223372036854775807,9223372036854775807),
PARTITION p2 VALUES LESS THAN (2000,9223372036854775807,9223372036854775807),
PARTITION p3 VALUES LESS THAN (3000,9223372036854775807,9223372036854775807),
PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807,9223372036854775807)
);
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t3;
Table,Create Table
t3,CREATE TABLE `t3` (
	`a` varchar(8) DEFAULT NULL,
	`b` varchar(16) DEFAULT NULL,
	`c` varchar(32) DEFAULT NULL,
	`d` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b_c` USING BTREE (`a`, `b`, `c`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`,`c`)
PARTITIONS 4
(PARTITION p1 VALUES LESS THAN (1000,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (2000,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB)
tablegroup = `tg1`
CREATE TABLE `t4` (
  `a` varchar(8) DEFAULT NULL,
  `b` varchar(16) DEFAULT NULL,
  `c` varchar(32) DEFAULT NULL,
  `d` int(11) DEFAULT NULL
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`,`c`,`d`) PARTITIONS 4 (
  PARTITION p1 VALUES LESS THAN (1000,9223372036854775807,9223372036854775807,9223372036854775807),
  PARTITION p2 VALUES LESS THAN (2000,9223372036854775807,9223372036854775807,9223372036854775807),
  PARTITION p3 VALUES LESS THAN (3000,9223372036854775807,9223372036854775807,9223372036854775807),
  PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807)
);
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t4;
Table,Create Table
t4,CREATE TABLE `t4` (
	`a` varchar(8) DEFAULT NULL,
	`b` varchar(16) DEFAULT NULL,
	`c` varchar(32) DEFAULT NULL,
	`d` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b_c_d` USING BTREE (`a`, `b`, `c`, `d`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`,`c`,`d`)
PARTITIONS 4
(PARTITION p1 VALUES LESS THAN (1000,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (2000,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB)
tablegroup = `tg1`
CREATE TABLE `t5` (
`a` varchar(8) DEFAULT NULL,
`b` varchar(16) DEFAULT NULL,
`c` varchar(32) DEFAULT NULL,
`d` int(11) DEFAULT NULL,
`e` datetime DEFAULT NULL
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`,`c`,`d`,`e`) PARTITIONS 4 (
PARTITION p1 VALUES LESS THAN (1000,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807),
PARTITION p2 VALUES LESS THAN (2000,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807),
PARTITION p3 VALUES LESS THAN (3000,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807),
PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807)
);
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t5;
Table,Create Table
t5,CREATE TABLE `t5` (
	`a` varchar(8) DEFAULT NULL,
	`b` varchar(16) DEFAULT NULL,
	`c` varchar(32) DEFAULT NULL,
	`d` int(11) DEFAULT NULL,
	`e` datetime DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b_c_d_e` USING BTREE (`a`, `b`, `c`, `d`, `e`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`,`c`,`d`,`e`)
PARTITIONS 4
(PARTITION p1 VALUES LESS THAN (1000,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (2000,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB)
tablegroup = `tg1`
alter tablegroup tg1 split partition p1;
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t5;
Table,Create Table
t5,CREATE TABLE `t5` (
	`a` varchar(8) DEFAULT NULL,
	`b` varchar(16) DEFAULT NULL,
	`c` varchar(32) DEFAULT NULL,
	`d` int(11) DEFAULT NULL,
	`e` datetime DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b_c_d_e` USING BTREE (`a`, `b`, `c`, `d`, `e`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`,`c`,`d`,`e`)
PARTITIONS 5
(PARTITION p5 VALUES LESS THAN (-4611686018427387404,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p6 VALUES LESS THAN (1000,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (2000,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB)
tablegroup = `tg1`
alter tablegroup tg1 split partition p2;
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t5;
Table,Create Table
t5,CREATE TABLE `t5` (
	`a` varchar(8) DEFAULT NULL,
	`b` varchar(16) DEFAULT NULL,
	`c` varchar(32) DEFAULT NULL,
	`d` int(11) DEFAULT NULL,
	`e` datetime DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b_c_d_e` USING BTREE (`a`, `b`, `c`, `d`, `e`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`,`c`,`d`,`e`)
PARTITIONS 6
(PARTITION p5 VALUES LESS THAN (-4611686018427387404,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p6 VALUES LESS THAN (1000,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p9 VALUES LESS THAN (1500,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p10 VALUES LESS THAN (2000,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB)
tablegroup = `tg1`
## error_msg: $# not all the tables in tablegroup #$
alter tablegroup tg1 extract to partition by hot value('a', 'a');
not all the tables in tablegroup
create tablegroup tg5;
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t2;
Table,Create Table
t2,CREATE TABLE `t2` (
	`a` varchar(8) DEFAULT NULL,
	`b` varchar(16) DEFAULT NULL,
	`c` varchar(32) DEFAULT NULL,
	`d` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`)
PARTITIONS 6
(PARTITION p5 VALUES LESS THAN (-4611686018427387404,9223372036854775807) ENGINE = InnoDB,
 PARTITION p6 VALUES LESS THAN (1000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p9 VALUES LESS THAN (1500,9223372036854775807) ENGINE = InnoDB,
 PARTITION p10 VALUES LESS THAN (2000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
tablegroup = `tg1`
alter table t2 set tablegroup=tg5;
## error_msg: $# should equal to the size of sharding key list #$
alter tablegroup tg5 extract to partition by hot value('b');
should equal to the size of sharding key list
alter tablegroup tg5 extract to partition by hot value('a', 'a');
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t2;
Table,Create Table
t2,CREATE TABLE `t2` (
	`a` varchar(8) DEFAULT NULL,
	`b` varchar(16) DEFAULT NULL,
	`c` varchar(32) DEFAULT NULL,
	`d` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`)
PARTITIONS 8
(PARTITION p1 VALUES LESS THAN (-6301204508261176706,-6301204508261176706) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (-6301204508261176706,-6301204508261176705) ENGINE = InnoDB,
 PARTITION p7 VALUES LESS THAN (-4611686018427387404,9223372036854775807) ENGINE = InnoDB,
 PARTITION p6 VALUES LESS THAN (1000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p9 VALUES LESS THAN (1500,9223372036854775807) ENGINE = InnoDB,
 PARTITION p10 VALUES LESS THAN (2000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
tablegroup = `tg5`
## error_msg: $# only one split partition is allowed #$
alter tablegroup tg5 split into pcc partitions 2 by hot value('c', 'c');
only one split partition is allowed
alter tablegroup tg5 split into pcc partitions 1 by hot value('c', 'c');
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t2;
Table,Create Table
t2,CREATE TABLE `t2` (
	`a` varchar(8) DEFAULT NULL,
	`b` varchar(16) DEFAULT NULL,
	`c` varchar(32) DEFAULT NULL,
	`d` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`)
PARTITIONS 10
(PARTITION p1 VALUES LESS THAN (-6301204508261176706,-6301204508261176706) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (-6301204508261176706,-6301204508261176705) ENGINE = InnoDB,
 PARTITION p7 VALUES LESS THAN (-4611686018427387404,9223372036854775807) ENGINE = InnoDB,
 PARTITION p14 VALUES LESS THAN (-455356769829958672,-455356769829958673) ENGINE = InnoDB,
 PARTITION pcc1 VALUES LESS THAN (-455356769829958672,-455356769829958671) ENGINE = InnoDB,
 PARTITION p15 VALUES LESS THAN (1000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p9 VALUES LESS THAN (1500,9223372036854775807) ENGINE = InnoDB,
 PARTITION p10 VALUES LESS THAN (2000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
tablegroup = `tg5`
alter tablegroup tg5 split into pd partitions 2 by hot value('d');
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t2;
Table,Create Table
t2,CREATE TABLE `t2` (
	`a` varchar(8) DEFAULT NULL,
	`b` varchar(16) DEFAULT NULL,
	`c` varchar(32) DEFAULT NULL,
	`d` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`)
PARTITIONS 13
(PARTITION p1 VALUES LESS THAN (-6301204508261176706,-6301204508261176706) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (-6301204508261176706,-6301204508261176705) ENGINE = InnoDB,
 PARTITION p7 VALUES LESS THAN (-4611686018427387404,9223372036854775807) ENGINE = InnoDB,
 PARTITION p14 VALUES LESS THAN (-455356769829958672,-455356769829958673) ENGINE = InnoDB,
 PARTITION pcc1 VALUES LESS THAN (-455356769829958672,-455356769829958671) ENGINE = InnoDB,
 PARTITION p15 VALUES LESS THAN (1000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p9 VALUES LESS THAN (1500,9223372036854775807) ENGINE = InnoDB,
 PARTITION p10 VALUES LESS THAN (2000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p19 VALUES LESS THAN (1101822470030053311,9223372036854775807) ENGINE = InnoDB,
 PARTITION pd1 VALUES LESS THAN (1101822470030053312,-2) ENGINE = InnoDB,
 PARTITION pd2 VALUES LESS THAN (1101822470030053313,9223372036854775807) ENGINE = InnoDB,
 PARTITION p20 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
tablegroup = `tg5`