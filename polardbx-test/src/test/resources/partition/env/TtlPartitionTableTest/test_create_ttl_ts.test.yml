## DISABLE_FAST_SQL_PARSER

set TTL_DEBUG_USE_GSI_FOR_COLUMNAR_ARC_TBL = false;
set TTL_DEBUG_CCI_SKIP_DDL_TASKS = "WaitColumnarTableAlterPartitionTask,WaitColumnarTableCreationTask";
set SKIP_DDL_TASKS="WaitColumnarTableAlterPartitionTask,WaitColumnarTableCreationTask";
set TTL_DEBUG_CURRENT_DATETIME='2024-06-27 00:00:00';
set TTL_FORBID_DROP_TTL_TBL_WITH_ARC_CCI = false;
set time_zone='+08:00';

create table my_ttl_ts_t1(
a int not null auto_increment,
b timestamp default current_timestamp,
primary key(a)
)
partition by key(a) partitions 2;
alter table my_ttl_ts_t1 modify ttl set TTL_ENABLE = 'OFF' TTL_EXPR = `b` EXPIRE AFTER 2 MONTH TIMEZONE '+08:00' TTL_JOB = CRON '* * */2 * * ?' TIMEZONE '+08:00' ARCHIVE_TABLE_PRE_ALLOCATE=5, ARCHIVE_TABLE_POST_ALLOCATE=3;
show create table my_ttl_ts_t1;
alter table my_ttl_ts_t1 modify ttl set ARCHIVE_TABLE_PRE_ALLOCATE = 3 ARCHIVE_TABLE_POST_ALLOCATE = 3;
show create table my_ttl_ts_t1;
create table my_arc_ts_t1 like my_ttl_ts_t1 ENGINE='COLUMNAR' ARCHIVE_MODE='TTL';
show create table my_ttl_ts_t1;
alter table my_ttl_ts_t1 modify ttl set ARCHIVE_TABLE_PRE_ALLOCATE = 4 ARCHIVE_TABLE_POST_ALLOCATE = 3;
alter table my_ttl_ts_t1 cleanup expired data;
show create table my_ttl_ts_t1;

set time_zone='+08:00';
create table rng_dt (dt datetime)
PARTITION BY RANGE COLUMNS(`dt`)
(PARTITION pstart VALUES LESS THAN ('1970-01-02 00:00:00') ENGINE = InnoDB,
PARTITION p202403 VALUES LESS THAN ('2024-04-01 00:00:00') ENGINE = InnoDB,
PARTITION p202404 VALUES LESS THAN ('2024-05-01 00:00:00') ENGINE = InnoDB,
PARTITION p202405 VALUES LESS THAN ('2024-06-01 00:00:00') ENGINE = InnoDB,
PARTITION p202406 VALUES LESS THAN ('2024-07-01 00:00:00') ENGINE = InnoDB,
PARTITION p202407 VALUES LESS THAN ('2024-08-01 00:00:00') ENGINE = InnoDB,
PARTITION p202408 VALUES LESS THAN ('2024-09-01 00:00:00') ENGINE = InnoDB,
PARTITION p202409 VALUES LESS THAN ('2024-10-01 00:00:00') ENGINE = InnoDB);
show create table rng_dt;

create table rng_ts (ts timestamp  default current_timestamp)
PARTITION BY RANGE(UNIX_TIMESTAMP(`ts`))
(PARTITION pstart VALUES LESS THAN (UNIX_TIMESTAMP('1970-01-02 00:00:00')) ENGINE = InnoDB,
PARTITION p202403 VALUES LESS THAN (UNIX_TIMESTAMP('2024-04-01 00:00:00')) ENGINE = InnoDB,
PARTITION p202404 VALUES LESS THAN (UNIX_TIMESTAMP('2024-05-01 00:00:00')) ENGINE = InnoDB,
PARTITION p202405 VALUES LESS THAN (UNIX_TIMESTAMP('2024-06-01 00:00:00')) ENGINE = InnoDB,
PARTITION p202406 VALUES LESS THAN (UNIX_TIMESTAMP('2024-07-01 00:00:00')) ENGINE = InnoDB,
PARTITION p202407 VALUES LESS THAN (UNIX_TIMESTAMP('2024-08-01 00:00:00')) ENGINE = InnoDB,
PARTITION p202408 VALUES LESS THAN (UNIX_TIMESTAMP('2024-09-01 00:00:00')) ENGINE = InnoDB,
PARTITION p202409 VALUES LESS THAN (UNIX_TIMESTAMP('2024-10-01 00:00:00')) ENGINE = InnoDB);
show create table rng_ts;

set time_zone='+08:00';
select UNIX_TIMESTAMP('1970-01-02 00:00:00'), FROM_UNIXTIME(57600);
select UNIX_TIMESTAMP('2024-04-01 00:00:00'), FROM_UNIXTIME(1711900800);
select UNIX_TIMESTAMP('2024-05-01 00:00:00'), FROM_UNIXTIME(1714492800);
select UNIX_TIMESTAMP('2024-06-01 00:00:00'), FROM_UNIXTIME(1717171200);
select UNIX_TIMESTAMP('2024-07-01 00:00:00'), FROM_UNIXTIME(1719763200);
select UNIX_TIMESTAMP('2024-08-01 00:00:00'), FROM_UNIXTIME(1722441600);
select UNIX_TIMESTAMP('2024-09-01 00:00:00'), FROM_UNIXTIME(1725120000);
select UNIX_TIMESTAMP('2024-10-01 00:00:00'), FROM_UNIXTIME(1727712000);
select UNIX_TIMESTAMP('2024-11-01 00:00:00'), FROM_UNIXTIME(1730390400);
select UNIX_TIMESTAMP('2024-12-01 00:00:00'), FROM_UNIXTIME(1732982400);
