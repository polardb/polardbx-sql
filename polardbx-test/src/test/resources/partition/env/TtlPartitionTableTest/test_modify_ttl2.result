## DISABLE_FAST_SQL_PARSER
set TTL_DEBUG_USE_GSI_FOR_COLUMNAR_ARC_TBL = false
set TTL_DEBUG_CCI_SKIP_DDL_TASKS = "WaitColumnarTableAlterPartitionTask,WaitColumnarTableCreationTask"
set SKIP_DDL_TASKS="WaitColumnarTableAlterPartitionTask,WaitColumnarTableCreationTask"
set TTL_DEBUG_CURRENT_DATETIME='2024-06-27 00:00:00'
set TTL_FORBID_DROP_TTL_TBL_WITH_ARC_CCI = false
set time_zone='+08:00'
create table my_modify_ttl_t1(
a int not null auto_increment,
b datetime default current_timestamp,
primary key(a)
)
TTL = TTL_DEFINITION (
TTL_ENABLE = 'OFF',
TTL_EXPR = `b` EXPIRE AFTER 2 MONTH TIMEZONE '+08:00',
TTL_JOB = CRON '*/1 * * * * ?' TIMEZONE '+08:00',
ARCHIVE_TYPE = '' ARCHIVE_TABLE_SCHEMA = '',
ARCHIVE_TABLE_NAME = '',
ARCHIVE_TABLE_PRE_ALLOCATE = 3,
ARCHIVE_TABLE_POST_ALLOCATE = 4
)
partition by key(a) partitions 2
show create table my_modify_ttl_t1
Table,Create Table
my_modify_ttl_t1,CREATE TABLE `my_modify_ttl_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 MONTH TIMEZONE '+08:00', TTL_JOB = CRON '*/1 * * * * ?', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, MONTH), ARCHIVE_TYPE = 'ROW', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 3, ARCHIVE_TABLE_POST_ALLOCATE = 4 )
PARTITION BY KEY(`a`)
PARTITIONS 2
alter table my_modify_ttl_t1 modify ttl
set
TTL_ENABLE = 'OFF',
TTL_EXPR = `b` EXPIRE AFTER 2 MONTH TIMEZONE '+08:00',
TTL_JOB = CRON '*/1 * * * * ?' TIMEZONE '+08:00',
ARCHIVE_TABLE_SCHEMA = '',
ARCHIVE_TABLE_NAME = '',
ARCHIVE_TABLE_PRE_ALLOCATE = 1,
ARCHIVE_TABLE_POST_ALLOCATE = 1
show create table my_modify_ttl_t1
Table,Create Table
my_modify_ttl_t1,CREATE TABLE `my_modify_ttl_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 MONTH TIMEZONE '+08:00', TTL_JOB = CRON '*/1 * * * * ?', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, MONTH), ARCHIVE_TYPE = 'ROW', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 1, ARCHIVE_TABLE_POST_ALLOCATE = 1 )
PARTITION BY KEY(`a`)
PARTITIONS 2
create table my_modify_arc_t1 like my_modify_ttl_t1 engine='columnar' archive_mode='ttl'
show create table my_modify_ttl_t1
Table,Create Table
my_modify_ttl_t1,CREATE TABLE `my_modify_ttl_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_my_modify_arc_t1` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20240501 VALUES LESS THAN ('2024-05-01 00:00:00') ENGINE = Columnar,
		 PARTITION p20240601 VALUES LESS THAN ('2024-06-01 00:00:00') ENGINE = Columnar,
		 PARTITION p20240701 VALUES LESS THAN ('2024-07-01 00:00:00') ENGINE = Columnar,
		 PARTITION p20240801 VALUES LESS THAN ('2024-08-01 00:00:00') ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 MONTH TIMEZONE '+08:00', TTL_JOB = CRON '*/1 * * * * ?', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, MONTH), ARCHIVE_TYPE = 'ROW', ARCHIVE_TABLE_NAME = 'my_modify_arc_t1', ARCHIVE_TABLE_PRE_ALLOCATE = 1, ARCHIVE_TABLE_POST_ALLOCATE = 1 )
PARTITION BY KEY(`a`)
PARTITIONS 2
alter table my_modify_ttl_t1 modify ttl set archive_table_pre_allocate = 2, archive_table_post_allocate = 1
show create table my_modify_ttl_t1
Table,Create Table
my_modify_ttl_t1,CREATE TABLE `my_modify_ttl_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_my_modify_arc_t1` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20240501 VALUES LESS THAN ('2024-05-01 00:00:00') ENGINE = Columnar,
		 PARTITION p20240601 VALUES LESS THAN ('2024-06-01 00:00:00') ENGINE = Columnar,
		 PARTITION p20240701 VALUES LESS THAN ('2024-07-01 00:00:00') ENGINE = Columnar,
		 PARTITION p20240801 VALUES LESS THAN ('2024-08-01 00:00:00') ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 MONTH TIMEZONE '+08:00', TTL_JOB = CRON '*/1 * * * * ?', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, MONTH), ARCHIVE_TYPE = 'ROW', ARCHIVE_TABLE_NAME = 'my_modify_arc_t1', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 1 )
PARTITION BY KEY(`a`)
PARTITIONS 2
alter table my_modify_ttl_t1 cleanup expired data
show create table my_modify_ttl_t1
Table,Create Table
my_modify_ttl_t1,CREATE TABLE `my_modify_ttl_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_my_modify_arc_t1` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION p20240501 VALUES LESS THAN ('2024-05-01 00:00:00') ENGINE = Columnar,
		 PARTITION p20240601 VALUES LESS THAN ('2024-06-01 00:00:00') ENGINE = Columnar,
		 PARTITION p20240701 VALUES LESS THAN ('2024-07-01 00:00:00') ENGINE = Columnar,
		 PARTITION p20240801 VALUES LESS THAN ('2024-08-01 00:00:00') ENGINE = Columnar,
		 PARTITION p20240901 VALUES LESS THAN ('2024-09-01 00:00:00') ENGINE = Columnar,
		 PARTITION pmax VALUES LESS THAN (MAXVALUE) ENGINE = Columnar)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION ( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 MONTH TIMEZONE '+08:00', TTL_JOB = CRON '*/1 * * * * ?', TTL_CLEANUP = 'OFF', TTL_PART_INTERVAL = INTERVAL(1, MONTH), ARCHIVE_TYPE = 'ROW', ARCHIVE_TABLE_NAME = 'my_modify_arc_t1', ARCHIVE_TABLE_PRE_ALLOCATE = 2, ARCHIVE_TABLE_POST_ALLOCATE = 1 )
PARTITION BY KEY(`a`)
PARTITIONS 2
drop table my_modify_ttl_t1;