## DISABLE_FAST_SQL_PARSER
set TTL_DEBUG_USE_GSI_FOR_COLUMNAR_ARC_TBL = false
set TTL_DEBUG_CCI_SKIP_DDL_TASKS = "WaitColumnarTableAlterPartitionTask,WaitColumnarTableCreationTask"
set SKIP_DDL_TASKS="WaitColumnarTableAlterPartitionTask,WaitColumnarTableCreationTask"
set TTL_DEBUG_CURRENT_DATETIME='2024-06-27 00:00:00'
set TTL_FORBID_DROP_TTL_TBL_WITH_ARC_CCI = false
set time_zone='+08:00'
## error_msg: $# not the same #$
CREATE TABLE `my_ttl_with_cci_t1` (
`a` int(11) NOT NULL AUTO_INCREMENT,
`b` datetime DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (`a`),
CLUSTERED COLUMNAR INDEX `arctmp_my_arc_with_cci_t1` (`b`)
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION pstart VALUES LESS THAN ('1970-01-02 00:00:00') ENGINE = InnoDB,
PARTITION p202403 VALUES LESS THAN ('2024-04-01 00:00:00') ENGINE = InnoDB,
PARTITION p202404 VALUES LESS THAN ('2024-05-01 00:00:00') ENGINE = InnoDB,
PARTITION p202405 VALUES LESS THAN ('2024-06-01 00:00:00') ENGINE = InnoDB,
PARTITION p202406 VALUES LESS THAN ('2024-07-01 00:00:00') ENGINE = InnoDB,
PARTITION p202407 VALUES LESS THAN ('2024-08-01 00:00:00') ENGINE = InnoDB,
PARTITION p202408 VALUES LESS THAN ('2024-09-01 00:00:00') ENGINE = InnoDB,
PARTITION p202409 VALUES LESS THAN ('2024-10-01 00:00:00') ENGINE = InnoDB)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 MONTH TIMEZONE '+08:00', TTL_JOB = CRON '* * */2 * * ?' TIMEZONE '+08:00' ARCHIVE_TYPE = 'COLUMNAR', ARCHIVE_TABLE_SCHEMA = 'ttldb3', ARCHIVE_TABLE_SCHEMA='unknown_db', ARCHIVE_TABLE_NAME = 'my_arc_with_cci_t1', ARCHIVE_TABLE_PRE_ALLOCATE = 3, ARCHIVE_TABLE_POST_ALLOCATE = 3 ) PARTITION BY KEY(`a`) PARTITIONS 2
not the same
CREATE TABLE `my_ttl_with_cci_t1` (
`a` int(11) NOT NULL AUTO_INCREMENT,
`b` datetime DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (`a`),
CLUSTERED COLUMNAR INDEX `arctmp_my_arc_with_cci_t1` (`b`)
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION pstart VALUES LESS THAN ('1970-01-02 00:00:00') ENGINE = InnoDB,
PARTITION p202403 VALUES LESS THAN ('2024-04-01 00:00:00') ENGINE = InnoDB,
PARTITION p202404 VALUES LESS THAN ('2024-05-01 00:00:00') ENGINE = InnoDB,
PARTITION p202405 VALUES LESS THAN ('2024-06-01 00:00:00') ENGINE = InnoDB,
PARTITION p202406 VALUES LESS THAN ('2024-07-01 00:00:00') ENGINE = InnoDB,
PARTITION p202407 VALUES LESS THAN ('2024-08-01 00:00:00') ENGINE = InnoDB,
PARTITION p202408 VALUES LESS THAN ('2024-09-01 00:00:00') ENGINE = InnoDB,
PARTITION p202409 VALUES LESS THAN ('2024-10-01 00:00:00') ENGINE = InnoDB)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 MONTH TIMEZONE '+08:00', TTL_JOB = CRON '* * */2 * * ?' TIMEZONE '+08:00' ARCHIVE_TYPE = 'COLUMNAR', ARCHIVE_TABLE_NAME = 'my_arc_with_cci_t1', ARCHIVE_TABLE_PRE_ALLOCATE = 3, ARCHIVE_TABLE_POST_ALLOCATE = 3 ) PARTITION BY KEY(`a`) PARTITIONS 2
show create table my_ttl_with_cci_t1
Table,Create Table
my_ttl_with_cci_t1,CREATE TABLE `my_ttl_with_cci_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_my_arc_with_cci_t1` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION pstart VALUES LESS THAN ('1970-01-02 00:00:00') ENGINE = Columnar,
		 PARTITION p202403 VALUES LESS THAN ('2024-04-01 00:00:00') ENGINE = Columnar,
		 PARTITION p202404 VALUES LESS THAN ('2024-05-01 00:00:00') ENGINE = Columnar,
		 PARTITION p202405 VALUES LESS THAN ('2024-06-01 00:00:00') ENGINE = Columnar,
		 PARTITION p202406 VALUES LESS THAN ('2024-07-01 00:00:00') ENGINE = Columnar,
		 PARTITION p202407 VALUES LESS THAN ('2024-08-01 00:00:00') ENGINE = Columnar,
		 PARTITION p202408 VALUES LESS THAN ('2024-09-01 00:00:00') ENGINE = Columnar,
		 PARTITION p202409 VALUES LESS THAN ('2024-10-01 00:00:00') ENGINE = Columnar)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 MONTH TIMEZONE '+08:00', TTL_JOB = CRON '* * */2 * * ?' TIMEZONE '+08:00', ARCHIVE_TYPE = 'COLUMNAR', ARCHIVE_TABLE_NAME = 'my_arc_with_cci_t1', ARCHIVE_TABLE_PRE_ALLOCATE = 3, ARCHIVE_TABLE_POST_ALLOCATE = 3 )
PARTITION BY KEY(`a`)
PARTITIONS 2
show create table my_arc_with_cci_t1
View,Create View,character_set_client,collation_connection
my_arc_with_cci_t1,CREATE VIEW `my_arc_with_cci_t1` AS select `my_ttl_with_cci_t1`.`a`,`my_ttl_with_cci_t1`.`b` from `test_create_with_1204881928`.`my_ttl_with_cci_t1` force index (`arctmp_my_arc_with_cci_t1`);,utf8,utf8_general_ci
alter table my_ttl_with_cci_t1 modify ttl set ARCHIVE_TABLE_PRE_ALLOCATE = 4
alter table my_ttl_with_cci_t1 cleanup expired data
show create table my_ttl_with_cci_t1
Table,Create Table
my_ttl_with_cci_t1,CREATE TABLE `my_ttl_with_cci_t1` (
	`a` int(11) NOT NULL AUTO_INCREMENT,
	`b` datetime DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY (`a`),
	CLUSTERED COLUMNAR INDEX `arctmp_my_arc_with_cci_t1` (`b`)
		PARTITION BY RANGE COLUMNS(`b`)
		(PARTITION pstart VALUES LESS THAN ('1970-01-02 00:00:00') ENGINE = Columnar,
		 PARTITION p202403 VALUES LESS THAN ('2024-04-01 00:00:00') ENGINE = Columnar,
		 PARTITION p202404 VALUES LESS THAN ('2024-05-01 00:00:00') ENGINE = Columnar,
		 PARTITION p202405 VALUES LESS THAN ('2024-06-01 00:00:00') ENGINE = Columnar,
		 PARTITION p202406 VALUES LESS THAN ('2024-07-01 00:00:00') ENGINE = Columnar,
		 PARTITION p202407 VALUES LESS THAN ('2024-08-01 00:00:00') ENGINE = Columnar,
		 PARTITION p202408 VALUES LESS THAN ('2024-09-01 00:00:00') ENGINE = Columnar,
		 PARTITION p202409 VALUES LESS THAN ('2024-10-01 00:00:00') ENGINE = Columnar,
		 PARTITION p202410 VALUES LESS THAN ('2024-11-01 00:00:00') ENGINE = Columnar)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 TTL = TTL_DEFINITION( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 MONTH TIMEZONE '+08:00', TTL_JOB = CRON '* * */2 * * ?' TIMEZONE '+08:00', ARCHIVE_TYPE = 'COLUMNAR', ARCHIVE_TABLE_NAME = 'my_arc_with_cci_t1', ARCHIVE_TABLE_PRE_ALLOCATE = 4, ARCHIVE_TABLE_POST_ALLOCATE = 3 )
PARTITION BY KEY(`a`)
PARTITIONS 2
drop table my_ttl_with_cci_t1;