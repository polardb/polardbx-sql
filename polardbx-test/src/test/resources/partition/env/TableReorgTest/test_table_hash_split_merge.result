## DISABLE_FAST_SQL_PARSER
CREATE TABLE `t1` (
`a` int(11) DEFAULT NULL,
`b` int(11) DEFAULT NULL,
`c` int(11) DEFAULT NULL
) ENGINE = InnoDB
PARTITION BY KEY(`a`,`b`) PARTITIONS 4 (
  PARTITION p1 VALUES LESS THAN (1000,9223372036854775807),
  PARTITION p2 VALUES LESS THAN (2000,9223372036854775807),
  PARTITION p3 VALUES LESS THAN (3000,9223372036854775807),
  PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807)
);
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t1;
Table,Create Table
t1,CREATE TABLE `t1` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8
PARTITION BY KEY(`a`,`b`)
PARTITIONS 4
(PARTITION p1 VALUES LESS THAN (1000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (2000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
/* tablegroup = `tg` */
CREATE TABLE `t2` (
  `a` int(11) DEFAULT NULL,
  `b` int(11) DEFAULT NULL,
  `c` int(11) DEFAULT NULL
) ENGINE = InnoDB
PARTITION BY KEY(`a`) PARTITIONS 4 (
  PARTITION p1 VALUES LESS THAN (1000),
  PARTITION p2 VALUES LESS THAN (2000),
  PARTITION p3 VALUES LESS THAN (3000),
  PARTITION p4 VALUES LESS THAN (9223372036854775807)
);
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t2;
Table,Create Table
t2,CREATE TABLE `t2` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a` USING BTREE (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8
PARTITION BY KEY(`a`)
PARTITIONS 4
(PARTITION p1 VALUES LESS THAN (1000) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (2000) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807) ENGINE = InnoDB)
/* tablegroup = `tg` */
CREATE TABLE `t3` (
`a` int(11) DEFAULT NULL,
`b` int(11) DEFAULT NULL,
`c` int(11) DEFAULT NULL
) ENGINE = InnoDB
PARTITION BY KEY(`a`,`b`,`c`) PARTITIONS 4 (
  PARTITION p1 VALUES LESS THAN (1000,9223372036854775807,9223372036854775807),
  PARTITION p2 VALUES LESS THAN (2000,9223372036854775807,9223372036854775807),
  PARTITION p3 VALUES LESS THAN (3000,9223372036854775807,9223372036854775807),
  PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807,9223372036854775807)
);
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t3;
Table,Create Table
t3,CREATE TABLE `t3` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b_c` USING BTREE (`a`, `b`, `c`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8
PARTITION BY KEY(`a`,`b`,`c`)
PARTITIONS 4
(PARTITION p1 VALUES LESS THAN (1000,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (2000,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB)
/* tablegroup = `tg` */
explain select t1.a from t1 join t2 on t1.a=t2.a;
Logical ExecutionPlan
Gather(concurrent=true)
  LogicalView(tables="t1[p1,p2,p3,p4],t2[p1,p2,p3,p4]", shardCount=4, sql="SELECT `t1`.`a` FROM `t1` AS `t1` INNER JOIN `t2` AS `t2` ON (`t1`.`a` = `t2`.`a`)")
explain select t1.a from t1 join t3 on t1.a=t3.a;
Logical ExecutionPlan
Gather(concurrent=true)
  LogicalView(tables="t1[p1,p2,p3,p4],t3[p1,p2,p3,p4]", shardCount=4, sql="SELECT `t1`.`a` FROM `t1` AS `t1` INNER JOIN `t3` AS `t3` ON (`t1`.`a` = `t3`.`a`)")
alter table t1 split partition p3 into (
  PARTITION p3_1 VALUES LESS THAN (2100),
  PARTITION p3_2 VALUES LESS THAN (3000)
);
alter table t2 split partition p3 into (
PARTITION p3_1 VALUES LESS THAN (2100),
PARTITION p3_2 VALUES LESS THAN (3000)
);
alter table t3 split partition p3 into (
PARTITION p3_1 VALUES LESS THAN (2100),
PARTITION p3_2 VALUES LESS THAN (3000)
);
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t1;
Table,Create Table
t1,CREATE TABLE `t1` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8
PARTITION BY KEY(`a`,`b`)
PARTITIONS 5
(PARTITION p1 VALUES LESS THAN (1000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (2000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3_1 VALUES LESS THAN (2100,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3_2 VALUES LESS THAN (3000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
/* tablegroup = `tg` */
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t2;
Table,Create Table
t2,CREATE TABLE `t2` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a` USING BTREE (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8
PARTITION BY KEY(`a`)
PARTITIONS 5
(PARTITION p1 VALUES LESS THAN (1000) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (2000) ENGINE = InnoDB,
 PARTITION p3_1 VALUES LESS THAN (2100) ENGINE = InnoDB,
 PARTITION p3_2 VALUES LESS THAN (3000) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807) ENGINE = InnoDB)
/* tablegroup = `tg` */
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t3;
Table,Create Table
t3,CREATE TABLE `t3` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b_c` USING BTREE (`a`, `b`, `c`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8
PARTITION BY KEY(`a`,`b`,`c`)
PARTITIONS 5
(PARTITION p1 VALUES LESS THAN (1000,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (2000,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3_1 VALUES LESS THAN (2100,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3_2 VALUES LESS THAN (3000,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB)
/* tablegroup = `tg` */
explain select t1.a from t1 join t2 on t1.a=t2.a;
Logical ExecutionPlan
Gather(concurrent=true)
  LogicalView(tables="t1[p1,p2,p3_1,p3_2,p4],t2[p1,p2,p3_1,p3_2,p4]", shardCount=5, sql="SELECT `t1`.`a` FROM `t1` AS `t1` INNER JOIN `t2` AS `t2` ON (`t1`.`a` = `t2`.`a`)")
explain select t1.a from t1 join t3 on t1.a=t3.a;
Logical ExecutionPlan
Gather(concurrent=true)
  LogicalView(tables="t1[p1,p2,p3_1,p3_2,p4],t3[p1,p2,p3_1,p3_2,p4]", shardCount=5, sql="SELECT `t1`.`a` FROM `t1` AS `t1` INNER JOIN `t3` AS `t3` ON (`t1`.`a` = `t3`.`a`)")
alter table t1 merge partitions p3_1,p3_2 to p3;
alter table t2 merge partitions p3_1,p3_2 to p3;
alter table t3 merge partitions p3_1,p3_2 to p3;
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t1;
Table,Create Table
t1,CREATE TABLE `t1` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8
PARTITION BY KEY(`a`,`b`)
PARTITIONS 4
(PARTITION p1 VALUES LESS THAN (1000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (2000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
/* tablegroup = `tg` */
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t2;
Table,Create Table
t2,CREATE TABLE `t2` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a` USING BTREE (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8
PARTITION BY KEY(`a`)
PARTITIONS 4
(PARTITION p1 VALUES LESS THAN (1000) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (2000) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807) ENGINE = InnoDB)
/* tablegroup = `tg` */
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t3;
Table,Create Table
t3,CREATE TABLE `t3` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b_c` USING BTREE (`a`, `b`, `c`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8
PARTITION BY KEY(`a`,`b`,`c`)
PARTITIONS 4
(PARTITION p1 VALUES LESS THAN (1000,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (2000,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (3000,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB)
/* tablegroup = `tg` */
explain select t1.a from t1 join t2 on t1.a=t2.a;
Logical ExecutionPlan
Gather(concurrent=true)
  LogicalView(tables="t1[p1,p2,p3,p4],t2[p1,p2,p3,p4]", shardCount=4, sql="SELECT `t1`.`a` FROM `t1` AS `t1` INNER JOIN `t2` AS `t2` ON (`t1`.`a` = `t2`.`a`)")
explain select t1.a from t1 join t3 on t1.a=t3.a;
Logical ExecutionPlan
Gather(concurrent=true)
  LogicalView(tables="t1[p1,p2,p3,p4],t3[p1,p2,p3,p4]", shardCount=4, sql="SELECT `t1`.`a` FROM `t1` AS `t1` INNER JOIN `t3` AS `t3` ON (`t1`.`a` = `t3`.`a`)")
alter table t1 rename partition p3 to p3_OlD, p2 to P2_oLd;
alter table t2 rename partition p3 to p3_OlD, p2 to P2_oLd;
alter table t3 rename partition p3 to p3_OlD, p2 to P2_oLd;
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t1;
Table,Create Table
t1,CREATE TABLE `t1` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8
PARTITION BY KEY(`a`,`b`)
PARTITIONS 4
(PARTITION p1 VALUES LESS THAN (1000,9223372036854775807) ENGINE = InnoDB,
 PARTITION P2_oLd VALUES LESS THAN (2000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3_OlD VALUES LESS THAN (3000,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
/* tablegroup = `tg` */
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t2;
Table,Create Table
t2,CREATE TABLE `t2` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a` USING BTREE (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8
PARTITION BY KEY(`a`)
PARTITIONS 4
(PARTITION p1 VALUES LESS THAN (1000) ENGINE = InnoDB,
 PARTITION P2_oLd VALUES LESS THAN (2000) ENGINE = InnoDB,
 PARTITION p3_OlD VALUES LESS THAN (3000) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807) ENGINE = InnoDB)
/* tablegroup = `tg` */
/*+TDDL:cmd_extra(SHOW_HASH_PARTITIONS_BY_RANGE=TRUE)*/show full create table t3;
Table,Create Table
t3,CREATE TABLE `t3` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	`c` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b_c` USING BTREE (`a`, `b`, `c`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8
PARTITION BY KEY(`a`,`b`,`c`)
PARTITIONS 4
(PARTITION p1 VALUES LESS THAN (1000,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION P2_oLd VALUES LESS THAN (2000,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3_OlD VALUES LESS THAN (3000,9223372036854775807,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (9223372036854775807,9223372036854775807,9223372036854775807) ENGINE = InnoDB)
/* tablegroup = `tg` */
explain select t1.a from t1 join t2 on t1.a=t2.a;
Logical ExecutionPlan
Gather(concurrent=true)
  LogicalView(tables="t1[p1,P2_oLd,p3_OlD,p4],t2[p1,P2_oLd,p3_OlD,p4]", shardCount=4, sql="SELECT `t1`.`a` FROM `t1` AS `t1` INNER JOIN `t2` AS `t2` ON (`t1`.`a` = `t2`.`a`)")
explain select t1.a from t1 join t3 on t1.a=t3.a;
Logical ExecutionPlan
Gather(concurrent=true)
  LogicalView(tables="t1[p1,P2_oLd,p3_OlD,p4],t3[p1,P2_oLd,p3_OlD,p4]", shardCount=4, sql="SELECT `t1`.`a` FROM `t1` AS `t1` INNER JOIN `t3` AS `t3` ON (`t1`.`a` = `t3`.`a`)")