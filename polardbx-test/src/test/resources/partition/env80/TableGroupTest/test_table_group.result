## DISABLE_FAST_SQL_PARSER
create tablegroup mytg1;
CREATE TABLE IF NOT EXISTS `t10` (`pk` BIGINT(11) NOT NULL AUTO_INCREMENT BY GROUP,`name` varchar(64) DEFAULT NULL,`money` int DEFAULT NULL, PRIMARY KEY (`pk`)) ENGINE=InnoDB DEFAULT CHARSET=UTF8 PARTITION BY KEY(money) PARTITIONS 8 tablegroup=mytg1;
show full create table t10;
Table,Create Table
t10,CREATE TABLE `t10` (
	`pk` bigint(11) NOT NULL AUTO_INCREMENT,
	`name` varchar(64) DEFAULT NULL,
	`money` int(11) DEFAULT NULL,
	PRIMARY KEY (`pk`),
	LOCAL KEY `auto_shard_key_money` USING BTREE (`money`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb3
PARTITION BY KEY(`money`)
PARTITIONS 8
tablegroup = `mytg1`
CREATE TABLE IF NOT EXISTS `t20` (`pk` BIGINT(11) NOT NULL AUTO_INCREMENT BY GROUP,`name` varchar(64) DEFAULT NULL,`money` int DEFAULT NULL, PRIMARY KEY (`pk`)) ENGINE=InnoDB DEFAULT CHARSET=UTF8 PARTITION BY KEY(money) PARTITIONS 8 tablegroup=mytg1;
show full create table t20;
Table,Create Table
t20,CREATE TABLE `t20` (
	`pk` bigint(11) NOT NULL AUTO_INCREMENT,
	`name` varchar(64) DEFAULT NULL,
	`money` int(11) DEFAULT NULL,
	PRIMARY KEY (`pk`),
	LOCAL KEY `auto_shard_key_money` USING BTREE (`money`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb3
PARTITION BY KEY(`money`)
PARTITIONS 8
tablegroup = `mytg1`
drop table t20;
drop table t10;
CREATE TABLE IF NOT EXISTS `t20` (`pk` BIGINT(11) NOT NULL AUTO_INCREMENT BY GROUP,`name` varchar(64) DEFAULT NULL,`money` int DEFAULT NULL, PRIMARY KEY (`pk`)) ENGINE=InnoDB DEFAULT CHARSET=UTF8 PARTITION BY KEY(money) PARTITIONS 3 tablegroup=mytg1;
show full create table t20;
Table,Create Table
t20,CREATE TABLE `t20` (
	`pk` bigint(11) NOT NULL AUTO_INCREMENT,
	`name` varchar(64) DEFAULT NULL,
	`money` int(11) DEFAULT NULL,
	PRIMARY KEY (`pk`),
	LOCAL KEY `auto_shard_key_money` USING BTREE (`money`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb3
PARTITION BY KEY(`money`)
PARTITIONS 3
tablegroup = `mytg1`
create tablegroup mytg2;
DROP TABLE IF EXISTS t01;
CREATE TABLE IF NOT EXISTS `t01` (`a` int(11) DEFAULT NULL,`b` int(11) DEFAULT NULL) PARTITION BY KEY(`a`,`b`) PARTITIONS 5 tablegroup=mytg2;
alter table t01 split into hotpart2 partitions 10 by hot value(15);
show full create table t01;
Table,Create Table
t01,CREATE TABLE `t01` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`)
PARTITIONS 16
tablegroup = `mytg2`
select TABLE_GROUP_NAME,LOCALITY,PRIMARY_ZONE,IS_MANUAL_CREATE,PART_INFO from information_schema.full_table_group where table_group_name='mytg2';
TABLE_GROUP_NAME,LOCALITY,PRIMARY_ZONE,IS_MANUAL_CREATE,PART_INFO
mytg2,null,null,1,PARTITION BY KEY(INTEGER,INTEGER)
PARTITIONS 16
(PARTITION p6 VALUES LESS THAN (-7007240033346738274,9223372036854775807) ENGINE = InnoDB,
 PARTITION hotpart21 VALUES LESS THAN (-7007240033346738273,-7378697629483820648) ENGINE = InnoDB,
 PARTITION hotpart22 VALUES LESS THAN (-7007240033346738273,-5534023222112865488) ENGINE = InnoDB,
 PARTITION hotpart23 VALUES LESS THAN (-7007240033346738273,-3689348814741910328) ENGINE = InnoDB,
 PARTITION hotpart24 VALUES LESS THAN (-7007240033346738273,-1844674407370955168) ENGINE = InnoDB,
 PARTITION hotpart25 VALUES LESS THAN (-7007240033346738273,-8) ENGINE = InnoDB,
 PARTITION hotpart26 VALUES LESS THAN (-7007240033346738273,1844674407370955152) ENGINE = InnoDB,
 PARTITION hotpart27 VALUES LESS THAN (-7007240033346738273,3689348814741910312) ENGINE = InnoDB,
 PARTITION hotpart28 VALUES LESS THAN (-7007240033346738273,5534023222112865472) ENGINE = InnoDB,
 PARTITION hotpart29 VALUES LESS THAN (-7007240033346738273,7378697629483820632) ENGINE = InnoDB,
 PARTITION hotpart210 VALUES LESS THAN (-7007240033346738272,9223372036854775807) ENGINE = InnoDB,
 PARTITION p7 VALUES LESS THAN (-5534023222112865481,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (-1844674407370955159,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (1844674407370955163,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (5534023222112865485,9223372036854775807) ENGINE = InnoDB,
 PARTITION p5 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
alter tablegroup mytg2 split into hotpart3 partitions 10 by hot value(15);
show full create table t01;
Table,Create Table
t01,CREATE TABLE `t01` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`)
PARTITIONS 16
tablegroup = `mytg2`
select TABLE_GROUP_NAME,LOCALITY,PRIMARY_ZONE,IS_MANUAL_CREATE,PART_INFO from information_schema.full_table_group where table_group_name='mytg2';
TABLE_GROUP_NAME,LOCALITY,PRIMARY_ZONE,IS_MANUAL_CREATE,PART_INFO
mytg2,null,null,1,PARTITION BY KEY(INTEGER,INTEGER)
PARTITIONS 16
(PARTITION p6 VALUES LESS THAN (-7007240033346738274,9223372036854775807) ENGINE = InnoDB,
 PARTITION hotpart31 VALUES LESS THAN (-7007240033346738273,-7378697629483820648) ENGINE = InnoDB,
 PARTITION hotpart32 VALUES LESS THAN (-7007240033346738273,-5534023222112865488) ENGINE = InnoDB,
 PARTITION hotpart33 VALUES LESS THAN (-7007240033346738273,-3689348814741910328) ENGINE = InnoDB,
 PARTITION hotpart34 VALUES LESS THAN (-7007240033346738273,-1844674407370955168) ENGINE = InnoDB,
 PARTITION hotpart35 VALUES LESS THAN (-7007240033346738273,-8) ENGINE = InnoDB,
 PARTITION hotpart36 VALUES LESS THAN (-7007240033346738273,1844674407370955152) ENGINE = InnoDB,
 PARTITION hotpart37 VALUES LESS THAN (-7007240033346738273,3689348814741910312) ENGINE = InnoDB,
 PARTITION hotpart38 VALUES LESS THAN (-7007240033346738273,5534023222112865472) ENGINE = InnoDB,
 PARTITION hotpart39 VALUES LESS THAN (-7007240033346738273,7378697629483820632) ENGINE = InnoDB,
 PARTITION hotpart310 VALUES LESS THAN (-7007240033346738272,9223372036854775807) ENGINE = InnoDB,
 PARTITION p7 VALUES LESS THAN (-5534023222112865481,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (-1844674407370955159,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (1844674407370955163,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (5534023222112865485,9223372036854775807) ENGINE = InnoDB,
 PARTITION p5 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
alter tablegroup mytg2 split into hotpart3 partitions 8 by hot value(15);
show full create table t01;
Table,Create Table
t01,CREATE TABLE `t01` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`)
PARTITIONS 14
tablegroup = `mytg2`
alter table t01 split into hotpart3 partitions 7 by hot value(15);
show full create table t01;
Table,Create Table
t01,CREATE TABLE `t01` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`)
PARTITIONS 13
tablegroup = `mytg2`
select TABLE_GROUP_NAME,LOCALITY,PRIMARY_ZONE,IS_MANUAL_CREATE,PART_INFO from information_schema.full_table_group where table_group_name='mytg2';
TABLE_GROUP_NAME,LOCALITY,PRIMARY_ZONE,IS_MANUAL_CREATE,PART_INFO
mytg2,null,null,1,PARTITION BY KEY(INTEGER,INTEGER)
PARTITIONS 13
(PARTITION p6 VALUES LESS THAN (-7007240033346738274,9223372036854775807) ENGINE = InnoDB,
 PARTITION hotpart31 VALUES LESS THAN (-7007240033346738273,-6588122883467697006) ENGINE = InnoDB,
 PARTITION hotpart32 VALUES LESS THAN (-7007240033346738273,-3952873730080618204) ENGINE = InnoDB,
 PARTITION hotpart33 VALUES LESS THAN (-7007240033346738273,-1317624576693539402) ENGINE = InnoDB,
 PARTITION hotpart34 VALUES LESS THAN (-7007240033346738273,1317624576693539400) ENGINE = InnoDB,
 PARTITION hotpart35 VALUES LESS THAN (-7007240033346738273,3952873730080618202) ENGINE = InnoDB,
 PARTITION hotpart36 VALUES LESS THAN (-7007240033346738273,6588122883467697004) ENGINE = InnoDB,
 PARTITION hotpart37 VALUES LESS THAN (-7007240033346738272,9223372036854775807) ENGINE = InnoDB,
 PARTITION p7 VALUES LESS THAN (-5534023222112865481,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (-1844674407370955159,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (1844674407370955163,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (5534023222112865485,9223372036854775807) ENGINE = InnoDB,
 PARTITION p5 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
alter tablegroup mytg2 extract to partition exp1 by hot value(1,1);
show full create table t01;
Table,Create Table
t01,CREATE TABLE `t01` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`)
PARTITIONS 15
tablegroup = `mytg2`
select TABLE_GROUP_NAME,LOCALITY,PRIMARY_ZONE,IS_MANUAL_CREATE,PART_INFO from information_schema.full_table_group where table_group_name='mytg2';
TABLE_GROUP_NAME,LOCALITY,PRIMARY_ZONE,IS_MANUAL_CREATE,PART_INFO
mytg2,null,null,1,PARTITION BY KEY(INTEGER,INTEGER)
PARTITIONS 15
(PARTITION p6 VALUES LESS THAN (-7007240033346738274,9223372036854775807) ENGINE = InnoDB,
 PARTITION hotpart31 VALUES LESS THAN (-7007240033346738273,-6588122883467697006) ENGINE = InnoDB,
 PARTITION hotpart32 VALUES LESS THAN (-7007240033346738273,-3952873730080618204) ENGINE = InnoDB,
 PARTITION hotpart33 VALUES LESS THAN (-7007240033346738273,-1317624576693539402) ENGINE = InnoDB,
 PARTITION hotpart34 VALUES LESS THAN (-7007240033346738273,1317624576693539400) ENGINE = InnoDB,
 PARTITION hotpart35 VALUES LESS THAN (-7007240033346738273,3952873730080618202) ENGINE = InnoDB,
 PARTITION hotpart36 VALUES LESS THAN (-7007240033346738273,6588122883467697004) ENGINE = InnoDB,
 PARTITION hotpart37 VALUES LESS THAN (-7007240033346738272,9223372036854775807) ENGINE = InnoDB,
 PARTITION p7 VALUES LESS THAN (-5534023222112865481,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (-1844674407370955159,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (1844674407370955163,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (5534023222112865485,9223372036854775807) ENGINE = InnoDB,
 PARTITION p34 VALUES LESS THAN (6161172798010463909,6161172798010463908) ENGINE = InnoDB,
 PARTITION exp11 VALUES LESS THAN (6161172798010463909,6161172798010463910) ENGINE = InnoDB,
 PARTITION p35 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
alter tablegroup mytg2 extract to partition exp2 by hot value(1,2);
show full create table t01;
Table,Create Table
t01,CREATE TABLE `t01` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	`_drds_implicit_id_` bigint(20) NOT NULL AUTO_INCREMENT,
	PRIMARY KEY (`_drds_implicit_id_`),
	LOCAL KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`,`b`)
PARTITIONS 17
tablegroup = `mytg2`
select TABLE_GROUP_NAME,LOCALITY,PRIMARY_ZONE,IS_MANUAL_CREATE,PART_INFO from information_schema.full_table_group where table_group_name='mytg2';
TABLE_GROUP_NAME,LOCALITY,PRIMARY_ZONE,IS_MANUAL_CREATE,PART_INFO
mytg2,null,null,1,PARTITION BY KEY(INTEGER,INTEGER)
PARTITIONS 17
(PARTITION p6 VALUES LESS THAN (-7007240033346738274,9223372036854775807) ENGINE = InnoDB,
 PARTITION hotpart31 VALUES LESS THAN (-7007240033346738273,-6588122883467697006) ENGINE = InnoDB,
 PARTITION hotpart32 VALUES LESS THAN (-7007240033346738273,-3952873730080618204) ENGINE = InnoDB,
 PARTITION hotpart33 VALUES LESS THAN (-7007240033346738273,-1317624576693539402) ENGINE = InnoDB,
 PARTITION hotpart34 VALUES LESS THAN (-7007240033346738273,1317624576693539400) ENGINE = InnoDB,
 PARTITION hotpart35 VALUES LESS THAN (-7007240033346738273,3952873730080618202) ENGINE = InnoDB,
 PARTITION hotpart36 VALUES LESS THAN (-7007240033346738273,6588122883467697004) ENGINE = InnoDB,
 PARTITION hotpart37 VALUES LESS THAN (-7007240033346738272,9223372036854775807) ENGINE = InnoDB,
 PARTITION p7 VALUES LESS THAN (-5534023222112865481,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (-1844674407370955159,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (1844674407370955163,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (5534023222112865485,9223372036854775807) ENGINE = InnoDB,
 PARTITION p37 VALUES LESS THAN (6161172798010463909,-8757930400787925688) ENGINE = InnoDB,
 PARTITION exp21 VALUES LESS THAN (6161172798010463909,-8757930400787925686) ENGINE = InnoDB,
 PARTITION p38 VALUES LESS THAN (6161172798010463909,6161172798010463908) ENGINE = InnoDB,
 PARTITION exp11 VALUES LESS THAN (6161172798010463909,6161172798010463910) ENGINE = InnoDB,
 PARTITION p35 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
drop table if exists txxyz;
create table txxxyz(a int,b int, global index g1(b) partition by hash(b) partition 2, global index g2(a) partition by hash(a) partitions 2)partition by hash(a) partitions 2;
select length(tables)-length(replace(tables,',',''))+1 from information_schema.full_table_group where tables like '%txxxyz%';
length(tables) - length(replace(tables, ',', '')) + 1
3
create tablegroup t_mytg1;
create tablegroup t_mytg2;
create table t_t1(a int, b int , global index g1(b) tablegroup=t_mytg2 partition by key(b) partitions 3) partition by key(a) partitions 3 tablegroup=t_mytg1;
show create table t_t1;
Table,Create Table
t_t1,CREATE TABLE `t_t1` (
	`a` int(11) DEFAULT NULL,
	`b` int(11) DEFAULT NULL,
	GLOBAL INDEX `g1` (`b`) COVERING (`a`)
		PARTITION BY KEY(`b`)
		PARTITIONS 3,
	KEY `auto_shard_key_a` USING BTREE (`a`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY KEY(`a`)
PARTITIONS 3
tablegroup = `t_mytg1`
drop table t_t1;
drop tablegroup t_mytg1;
drop tablegroup t_mytg2;