## DISABLE_FAST_SQL_PARSER

set TTL_DEBUG_USE_GSI_FOR_COLUMNAR_ARC_TBL = true;
set TTL_DEBUG_CURRENT_DATETIME='2024-06-27 00:00:00';

create table my_ttl_with_cci_t1(
a int not null auto_increment,
b datetime default current_timestamp,
primary key(a)
)
partition by key(a) partitions 2;
alter table my_ttl_with_cci_t1 modify ttl set TTL_ENABLE = 'OFF' TTL_EXPR = `b` EXPIRE AFTER 2 MONTH TIMEZONE '+08:00' TTL_JOB = CRON '* * */2 * * ?' TIMEZONE '+08:00' ARCHIVE_TABLE_PRE_ALLOCATE = 3 ARCHIVE_TABLE_POST_ALLOCATE = 3;


create table my_arc_with_cci_t1 like my_ttl_with_cci_t1 ENGINE='COLUMNAR' ARCHIVE_MODE='TTL';


CREATE TABLE `my_ttl_with_gsi_t1` (
`a` int(11) NOT NULL AUTO_INCREMENT,
`b` datetime DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY (`a`),
CLUSTERED INDEX `gsi_b` (`b`)
PARTITION BY RANGE COLUMNS(`b`)
(PARTITION `pstart` VALUES LESS THAN ('1970-01-02 00:00:00') ENGINE = InnoDB,
PARTITION `p202403` VALUES LESS THAN ('2024-04-01 00:00:00') ENGINE = InnoDB,
PARTITION `p202404` VALUES LESS THAN ('2024-05-01 00:00:00') ENGINE = InnoDB,
PARTITION `p202405` VALUES LESS THAN ('2024-06-01 00:00:00') ENGINE = InnoDB,
PARTITION `p202406` VALUES LESS THAN ('2024-07-01 00:00:00') ENGINE = InnoDB,
PARTITION `p202407` VALUES LESS THAN ('2024-08-01 00:00:00') ENGINE = InnoDB,
PARTITION `p202408` VALUES LESS THAN ('2024-09-01 00:00:00') ENGINE = InnoDB,
PARTITION `p202409` VALUES LESS THAN ('2024-10-01 00:00:00') ENGINE = InnoDB)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 
  TTL = TTL_DEFINITION( TTL_ENABLE = 'OFF', TTL_EXPR = `b` EXPIRE AFTER 2 MONTH TIMEZONE '+08:00', TTL_JOB = CRON '* * */2 * * ?' TIMEZONE '+08:00' ARCHIVE_TYPE = '', ARCHIVE_TABLE_SCHEMA = '', ARCHIVE_TABLE_NAME = '', ARCHIVE_TABLE_PRE_ALLOCATE = 3, ARCHIVE_TABLE_POST_ALLOCATE = 3 )
PARTITION BY KEY(`a`)
PARTITIONS 2;


