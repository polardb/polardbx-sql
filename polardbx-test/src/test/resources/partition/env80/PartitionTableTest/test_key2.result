## DISABLE_FAST_SQL_PARSER
## test key/one col/int
create tablegroup tb_ab_hash;
drop table if exists t_ab_hash;
CREATE TABLE t_ab_hash (
	a int(11) NOT NULL,
	b int(11) NOT NULL
) ENGINE = InnoDB DEFAULT CHARSET = utf8
PARTITION BY KEY(a,b)
PARTITIONS 16;
alter table t_ab_hash set tablegroup='tb_ab_hash';
/*TDDL:SHOW_HASH_PARTITIONS_BY_RANGE=TRUE*/show create table t_ab_hash;
Table,Create Table
t_ab_hash,CREATE TABLE `t_ab_hash` (
	`a` int(11) NOT NULL,
	`b` int(11) NOT NULL,
	KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb3
PARTITION BY KEY(`a`,`b`)
PARTITIONS 16
(PARTITION p1 VALUES LESS THAN (-8070450532247928803,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (-6917529027641081829,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (-5764607523034234855,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (-4611686018427387881,9223372036854775807) ENGINE = InnoDB,
 PARTITION p5 VALUES LESS THAN (-3458764513820540907,9223372036854775807) ENGINE = InnoDB,
 PARTITION p6 VALUES LESS THAN (-2305843009213693933,9223372036854775807) ENGINE = InnoDB,
 PARTITION p7 VALUES LESS THAN (-1152921504606846959,9223372036854775807) ENGINE = InnoDB,
 PARTITION p8 VALUES LESS THAN (15,9223372036854775807) ENGINE = InnoDB,
 PARTITION p9 VALUES LESS THAN (1152921504606846989,9223372036854775807) ENGINE = InnoDB,
 PARTITION p10 VALUES LESS THAN (2305843009213693963,9223372036854775807) ENGINE = InnoDB,
 PARTITION p11 VALUES LESS THAN (3458764513820540937,9223372036854775807) ENGINE = InnoDB,
 PARTITION p12 VALUES LESS THAN (4611686018427387911,9223372036854775807) ENGINE = InnoDB,
 PARTITION p13 VALUES LESS THAN (5764607523034234885,9223372036854775807) ENGINE = InnoDB,
 PARTITION p14 VALUES LESS THAN (6917529027641081859,9223372036854775807) ENGINE = InnoDB,
 PARTITION p15 VALUES LESS THAN (8070450532247928833,9223372036854775807) ENGINE = InnoDB,
 PARTITION p16 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
tablegroup = `tb_ab_hash`
insert into t_ab_hash values (99,2000),(100,100),(100,101),(100,102),(100,103),(100,104),(100,105),(100,106),(100,107),(401,3000);
select * from t_ab_hash order by a,b;
a,b
99,2000
100,100
100,101
100,102
100,103
100,104
100,105
100,106
100,107
401,3000
explain select * from t_ab_hash where a=99 order by a,b;
Logical ExecutionPlan
LogicalView(tables="t_ab_hash[p3]", sql="SELECT `a`, `b` FROM `t_ab_hash` AS `t_ab_hash` WHERE (`a` = ?) ORDER BY `a`, `b`")
explain select * from t_ab_hash where a=100 order by a,b;
Logical ExecutionPlan
LogicalView(tables="t_ab_hash[p6]", sql="SELECT `a`, `b` FROM `t_ab_hash` AS `t_ab_hash` WHERE (`a` = ?) ORDER BY `a`, `b`")
explain select * from t_ab_hash where a=401 order by a,b;
Logical ExecutionPlan
LogicalView(tables="t_ab_hash[p10]", sql="SELECT `a`, `b` FROM `t_ab_hash` AS `t_ab_hash` WHERE (`a` = ?) ORDER BY `a`, `b`")
explain select * from t_ab_hash where a=99 order by a,b;
Logical ExecutionPlan
LogicalView(tables="t_ab_hash[p3]", sql="SELECT `a`, `b` FROM `t_ab_hash` AS `t_ab_hash` WHERE (`a` = ?) ORDER BY `a`, `b`")
explain select * from t_ab_hash where a=100 order by a,b;
Logical ExecutionPlan
LogicalView(tables="t_ab_hash[p6]", sql="SELECT `a`, `b` FROM `t_ab_hash` AS `t_ab_hash` WHERE (`a` = ?) ORDER BY `a`, `b`")
explain select * from t_ab_hash where a=401 order by a,b;
Logical ExecutionPlan
LogicalView(tables="t_ab_hash[p10]", sql="SELECT `a`, `b` FROM `t_ab_hash` AS `t_ab_hash` WHERE (`a` = ?) ORDER BY `a`, `b`")
explain select * from t_ab_hash where (a,b)=(100,102);
Logical ExecutionPlan
LogicalView(tables="t_ab_hash[p6]", sql="SELECT `a`, `b` FROM `t_ab_hash` AS `t_ab_hash` WHERE ((`a`, `b`) =(?, ?))")
explain select * from t_ab_hash where (a,b)=(100,105);
Logical ExecutionPlan
LogicalView(tables="t_ab_hash[p6]", sql="SELECT `a`, `b` FROM `t_ab_hash` AS `t_ab_hash` WHERE ((`a`, `b`) =(?, ?))")
explain select * from t_ab_hash where (a,b)=(100,107);
Logical ExecutionPlan
LogicalView(tables="t_ab_hash[p6]", sql="SELECT `a`, `b` FROM `t_ab_hash` AS `t_ab_hash` WHERE ((`a`, `b`) =(?, ?))")
explain select * from t_ab_hash where (a,b)=(100,103);
Logical ExecutionPlan
LogicalView(tables="t_ab_hash[p6]", sql="SELECT `a`, `b` FROM `t_ab_hash` AS `t_ab_hash` WHERE ((`a`, `b`) =(?, ?))")
select * from t_ab_hash where a=99 order by a,b;
a,b
99,2000
select * from t_ab_hash where a=100 order by a,b;
a,b
100,100
100,101
100,102
100,103
100,104
100,105
100,106
100,107
select * from t_ab_hash where a=100 and b=12345678912 order by a,b;
a,b
select * from t_ab_hash where a=401 order by a,b;
a,b
401,3000
select * from t_ab_hash where (a,b)=(100,102);
a,b
100,102
select * from t_ab_hash where (a,b)=(100,105);
a,b
100,105
select * from t_ab_hash where (a,b)=(100,107);
a,b
100,107
select * from t_ab_hash where (a,b)=(100,103);
a,b
100,103
ALTER TABLEGROUP tb_ab_hash SPLIT PARTITION p6
      INTO (
            PARTITION p6_1 VALUES LESS THAN (-2682556572937990697,9223372036854775807),
            PARTITION v100_1 VALUES LESS THAN (-2682556572937990696,-4611686018427387899),
            PARTITION v100_2 VALUES LESS THAN (-2682556572937990696,3),
            PARTITION v100_3 VALUES LESS THAN (-2682556572937990696,4611686018427387905),
            PARTITION v100_4 VALUES LESS THAN (-2682556572937990696,9223372036854775807),
            PARTITION p6_2 VALUES LESS THAN (-2305843009213693933,9223372036854775807)
            );
/*TDDL:SHOW_HASH_PARTITIONS_BY_RANGE=TRUE*/show create table t_ab_hash;
Table,Create Table
t_ab_hash,CREATE TABLE `t_ab_hash` (
	`a` int(11) NOT NULL,
	`b` int(11) NOT NULL,
	KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb3
PARTITION BY KEY(`a`,`b`)
PARTITIONS 21
(PARTITION p1 VALUES LESS THAN (-8070450532247928803,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (-6917529027641081829,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (-5764607523034234855,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (-4611686018427387881,9223372036854775807) ENGINE = InnoDB,
 PARTITION p5 VALUES LESS THAN (-3458764513820540907,9223372036854775807) ENGINE = InnoDB,
 PARTITION p6_1 VALUES LESS THAN (-2682556572937990697,9223372036854775807) ENGINE = InnoDB,
 PARTITION v100_1 VALUES LESS THAN (-2682556572937990696,-4611686018427387899) ENGINE = InnoDB,
 PARTITION v100_2 VALUES LESS THAN (-2682556572937990696,3) ENGINE = InnoDB,
 PARTITION v100_3 VALUES LESS THAN (-2682556572937990696,4611686018427387905) ENGINE = InnoDB,
 PARTITION v100_4 VALUES LESS THAN (-2682556572937990696,9223372036854775807) ENGINE = InnoDB,
 PARTITION p6_2 VALUES LESS THAN (-2305843009213693933,9223372036854775807) ENGINE = InnoDB,
 PARTITION p7 VALUES LESS THAN (-1152921504606846959,9223372036854775807) ENGINE = InnoDB,
 PARTITION p8 VALUES LESS THAN (15,9223372036854775807) ENGINE = InnoDB,
 PARTITION p9 VALUES LESS THAN (1152921504606846989,9223372036854775807) ENGINE = InnoDB,
 PARTITION p10 VALUES LESS THAN (2305843009213693963,9223372036854775807) ENGINE = InnoDB,
 PARTITION p11 VALUES LESS THAN (3458764513820540937,9223372036854775807) ENGINE = InnoDB,
 PARTITION p12 VALUES LESS THAN (4611686018427387911,9223372036854775807) ENGINE = InnoDB,
 PARTITION p13 VALUES LESS THAN (5764607523034234885,9223372036854775807) ENGINE = InnoDB,
 PARTITION p14 VALUES LESS THAN (6917529027641081859,9223372036854775807) ENGINE = InnoDB,
 PARTITION p15 VALUES LESS THAN (8070450532247928833,9223372036854775807) ENGINE = InnoDB,
 PARTITION p16 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
tablegroup = `tb_ab_hash`
explain select * from t_ab_hash where a=99 order by a,b;
Logical ExecutionPlan
PhyTableOperation(tables="t_ab_hash[p3]", sql="SELECT `t_ab_hash`.`a`, `t_ab_hash`.`b` FROM ? AS `t_ab_hash` WHERE (`t_ab_hash`.`a` = ?) ORDER BY `a`, `b`", params="99")
explain select * from t_ab_hash where a=100 order by a,b;
Logical ExecutionPlan
MergeSort(sort="a ASC,b ASC")
  LogicalView(tables="t_ab_hash[v100_1,v100_2,v100_3,v100_4]", shardCount=4, sql="SELECT `a`, `b` FROM `t_ab_hash` AS `t_ab_hash` WHERE (`a` = ?) ORDER BY `a`, `b`")
explain select * from t_ab_hash where a=401 order by a,b;
Logical ExecutionPlan
PhyTableOperation(tables="t_ab_hash[p10]", sql="SELECT `t_ab_hash`.`a`, `t_ab_hash`.`b` FROM ? AS `t_ab_hash` WHERE (`t_ab_hash`.`a` = ?) ORDER BY `a`, `b`", params="401")
explain select * from t_ab_hash where a=99 order by a,b;
Logical ExecutionPlan
PhyTableOperation(tables="t_ab_hash[p3]", sql="SELECT `t_ab_hash`.`a`, `t_ab_hash`.`b` FROM ? AS `t_ab_hash` WHERE (`t_ab_hash`.`a` = ?) ORDER BY `a`, `b`", params="99")
explain select * from t_ab_hash where a=100 order by a,b;
Logical ExecutionPlan
MergeSort(sort="a ASC,b ASC")
  LogicalView(tables="t_ab_hash[v100_1,v100_2,v100_3,v100_4]", shardCount=4, sql="SELECT `a`, `b` FROM `t_ab_hash` AS `t_ab_hash` WHERE (`a` = ?) ORDER BY `a`, `b`")
explain select * from t_ab_hash where a=401 order by a,b;
Logical ExecutionPlan
PhyTableOperation(tables="t_ab_hash[p10]", sql="SELECT `t_ab_hash`.`a`, `t_ab_hash`.`b` FROM ? AS `t_ab_hash` WHERE (`t_ab_hash`.`a` = ?) ORDER BY `a`, `b`", params="401")
explain select * from t_ab_hash where (a,b)=(100,102);
Logical ExecutionPlan
LogicalView(tables="t_ab_hash[v100_1]", sql="SELECT `a`, `b` FROM `t_ab_hash` AS `t_ab_hash` WHERE ((`a`, `b`) =(?, ?))")
explain select * from t_ab_hash where (a,b)=(100,105);
Logical ExecutionPlan
LogicalView(tables="t_ab_hash[v100_2]", sql="SELECT `a`, `b` FROM `t_ab_hash` AS `t_ab_hash` WHERE ((`a`, `b`) =(?, ?))")
explain select * from t_ab_hash where (a,b)=(100,107);
Logical ExecutionPlan
LogicalView(tables="t_ab_hash[v100_3]", sql="SELECT `a`, `b` FROM `t_ab_hash` AS `t_ab_hash` WHERE ((`a`, `b`) =(?, ?))")
explain select * from t_ab_hash where (a,b)=(100,103);
Logical ExecutionPlan
LogicalView(tables="t_ab_hash[v100_4]", sql="SELECT `a`, `b` FROM `t_ab_hash` AS `t_ab_hash` WHERE ((`a`, `b`) =(?, ?))")
select * from t_ab_hash where a=99 order by a,b;
a,b
99,2000
select * from t_ab_hash where a=100 order by a,b;
a,b
100,100
100,101
100,102
100,103
100,104
100,105
100,106
100,107
select * from t_ab_hash where a=100 and b=12345678912 order by a,b;
a,b
select * from t_ab_hash where a=401 order by a,b;
a,b
401,3000
select * from t_ab_hash where (a,b)=(100,102);
a,b
100,102
select * from t_ab_hash where (a,b)=(100,105);
a,b
100,105
select * from t_ab_hash where (a,b)=(100,107);
a,b
100,107
select * from t_ab_hash where (a,b)=(100,103);
a,b
100,103
ALTER TABLEGROUP tb_ab_hash MERGE PARTITIONS p6_1,v100_1,v100_2,v100_3,v100_4,p6_2 TO p6;
/*TDDL:SHOW_HASH_PARTITIONS_BY_RANGE=TRUE*/show create table t_ab_hash;
Table,Create Table
t_ab_hash,CREATE TABLE `t_ab_hash` (
	`a` int(11) NOT NULL,
	`b` int(11) NOT NULL,
	KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb3
PARTITION BY KEY(`a`,`b`)
PARTITIONS 16
(PARTITION p1 VALUES LESS THAN (-8070450532247928803,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (-6917529027641081829,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (-5764607523034234855,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (-4611686018427387881,9223372036854775807) ENGINE = InnoDB,
 PARTITION p5 VALUES LESS THAN (-3458764513820540907,9223372036854775807) ENGINE = InnoDB,
 PARTITION p6 VALUES LESS THAN (-2305843009213693933,9223372036854775807) ENGINE = InnoDB,
 PARTITION p7 VALUES LESS THAN (-1152921504606846959,9223372036854775807) ENGINE = InnoDB,
 PARTITION p8 VALUES LESS THAN (15,9223372036854775807) ENGINE = InnoDB,
 PARTITION p9 VALUES LESS THAN (1152921504606846989,9223372036854775807) ENGINE = InnoDB,
 PARTITION p10 VALUES LESS THAN (2305843009213693963,9223372036854775807) ENGINE = InnoDB,
 PARTITION p11 VALUES LESS THAN (3458764513820540937,9223372036854775807) ENGINE = InnoDB,
 PARTITION p12 VALUES LESS THAN (4611686018427387911,9223372036854775807) ENGINE = InnoDB,
 PARTITION p13 VALUES LESS THAN (5764607523034234885,9223372036854775807) ENGINE = InnoDB,
 PARTITION p14 VALUES LESS THAN (6917529027641081859,9223372036854775807) ENGINE = InnoDB,
 PARTITION p15 VALUES LESS THAN (8070450532247928833,9223372036854775807) ENGINE = InnoDB,
 PARTITION p16 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
tablegroup = `tb_ab_hash`
ALTER TABLEGROUP tb_ab_hash SPLIT PARTITION p1;
/*TDDL:SHOW_HASH_PARTITIONS_BY_RANGE=TRUE*/show create table t_ab_hash;
Table,Create Table
t_ab_hash,CREATE TABLE `t_ab_hash` (
	`a` int(11) NOT NULL,
	`b` int(11) NOT NULL,
	KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb3
PARTITION BY KEY(`a`,`b`)
PARTITIONS 17
(PARTITION p23 VALUES LESS THAN (-8646911284551352305,9223372036854775807) ENGINE = InnoDB,
 PARTITION p24 VALUES LESS THAN (-8070450532247928803,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (-6917529027641081829,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (-5764607523034234855,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (-4611686018427387881,9223372036854775807) ENGINE = InnoDB,
 PARTITION p5 VALUES LESS THAN (-3458764513820540907,9223372036854775807) ENGINE = InnoDB,
 PARTITION p6 VALUES LESS THAN (-2305843009213693933,9223372036854775807) ENGINE = InnoDB,
 PARTITION p7 VALUES LESS THAN (-1152921504606846959,9223372036854775807) ENGINE = InnoDB,
 PARTITION p8 VALUES LESS THAN (15,9223372036854775807) ENGINE = InnoDB,
 PARTITION p9 VALUES LESS THAN (1152921504606846989,9223372036854775807) ENGINE = InnoDB,
 PARTITION p10 VALUES LESS THAN (2305843009213693963,9223372036854775807) ENGINE = InnoDB,
 PARTITION p11 VALUES LESS THAN (3458764513820540937,9223372036854775807) ENGINE = InnoDB,
 PARTITION p12 VALUES LESS THAN (4611686018427387911,9223372036854775807) ENGINE = InnoDB,
 PARTITION p13 VALUES LESS THAN (5764607523034234885,9223372036854775807) ENGINE = InnoDB,
 PARTITION p14 VALUES LESS THAN (6917529027641081859,9223372036854775807) ENGINE = InnoDB,
 PARTITION p15 VALUES LESS THAN (8070450532247928833,9223372036854775807) ENGINE = InnoDB,
 PARTITION p16 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
tablegroup = `tb_ab_hash`
ALTER TABLEGROUP tb_ab_hash SPLIT PARTITION p16;
/*TDDL:SHOW_HASH_PARTITIONS_BY_RANGE=TRUE*/show create table t_ab_hash;
Table,Create Table
t_ab_hash,CREATE TABLE `t_ab_hash` (
	`a` int(11) NOT NULL,
	`b` int(11) NOT NULL,
	KEY `auto_shard_key_a_b` USING BTREE (`a`, `b`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb3
PARTITION BY KEY(`a`,`b`)
PARTITIONS 18
(PARTITION p23 VALUES LESS THAN (-8646911284551352305,9223372036854775807) ENGINE = InnoDB,
 PARTITION p24 VALUES LESS THAN (-8070450532247928803,9223372036854775807) ENGINE = InnoDB,
 PARTITION p2 VALUES LESS THAN (-6917529027641081829,9223372036854775807) ENGINE = InnoDB,
 PARTITION p3 VALUES LESS THAN (-5764607523034234855,9223372036854775807) ENGINE = InnoDB,
 PARTITION p4 VALUES LESS THAN (-4611686018427387881,9223372036854775807) ENGINE = InnoDB,
 PARTITION p5 VALUES LESS THAN (-3458764513820540907,9223372036854775807) ENGINE = InnoDB,
 PARTITION p6 VALUES LESS THAN (-2305843009213693933,9223372036854775807) ENGINE = InnoDB,
 PARTITION p7 VALUES LESS THAN (-1152921504606846959,9223372036854775807) ENGINE = InnoDB,
 PARTITION p8 VALUES LESS THAN (15,9223372036854775807) ENGINE = InnoDB,
 PARTITION p9 VALUES LESS THAN (1152921504606846989,9223372036854775807) ENGINE = InnoDB,
 PARTITION p10 VALUES LESS THAN (2305843009213693963,9223372036854775807) ENGINE = InnoDB,
 PARTITION p11 VALUES LESS THAN (3458764513820540937,9223372036854775807) ENGINE = InnoDB,
 PARTITION p12 VALUES LESS THAN (4611686018427387911,9223372036854775807) ENGINE = InnoDB,
 PARTITION p13 VALUES LESS THAN (5764607523034234885,9223372036854775807) ENGINE = InnoDB,
 PARTITION p14 VALUES LESS THAN (6917529027641081859,9223372036854775807) ENGINE = InnoDB,
 PARTITION p15 VALUES LESS THAN (8070450532247928833,9223372036854775807) ENGINE = InnoDB,
 PARTITION p25 VALUES LESS THAN (8646911284551352320,9223372036854775807) ENGINE = InnoDB,
 PARTITION p26 VALUES LESS THAN (9223372036854775807,9223372036854775807) ENGINE = InnoDB)
tablegroup = `tb_ab_hash`
drop table if exists t_ab_hash;