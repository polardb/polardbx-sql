
- sql: |
    select
      s_acctbal,
      s_name,
      n_name,
      p_partkey,
      p_mfgr,
      s_address,
      s_phone,
      s_comment
    from
      part,
      supplier,
      partsupp,
      nation,
      region
    where
      p_partkey = ps_partkey
      and s_suppkey = ps_suppkey
      and p_size = 15
      and p_type like '%BRASS'
      and s_nationkey = n_nationkey
      and n_regionkey = r_regionkey
      and r_name = 'EUROPE'
      and ps_supplycost = (
        select
                min(ps_supplycost)
            from
          partsupp,
          supplier,
          nation,
          region
        where
          p_partkey = ps_partkey
          and s_suppkey = ps_suppkey
          and s_nationkey = n_nationkey
          and n_regionkey = r_regionkey
          and r_name = 'EUROPE'
      )
    order by
      s_acctbal desc,
      n_name,
      s_name,
      p_partkey;

  plan: |

    exchange(distribution=single, collation=[0 desc-nulls-last, 2 asc-nulls-first, 1 asc-nulls-first, 3 asc-nulls-first])
      memsort(sort="s_acctbal desc,n_name asc,s_name asc,p_partkey asc")
        project(s_acctbal="s_acctbal", s_name="s_name", n_name="n_name", p_partkey="p_partkey", p_mfgr="p_mfgr", s_address="s_address", s_phone="s_phone", s_comment="s_comment")
          hashjoin(condition="ps_suppkey = s_suppkey", type="inner")
            exchange(distribution=hash[0], collation=[])
              logicalview(tables="supplier[p1,p2,p3,p4],nation,region", shardcount=4, sql="select `supplier`.`s_suppkey`, `supplier`.`s_name`, `supplier`.`s_address`, `supplier`.`s_phone`, `supplier`.`s_acctbal`, `supplier`.`s_comment`, `nation`.`n_name` from `supplier` as `supplier` inner join `nation` as `nation` on (`supplier`.`s_nationkey` = `nation`.`n_nationkey`) inner join `region` as `region` on ((`nation`.`n_regionkey` = `region`.`r_regionkey`) and (`region`.`r_name` = 'europe'))")
            exchange(distribution=hash[5], collation=[])
              hashjoin(condition="ps_partkey = ps_partkey and ps_partkey = p_partkey and ps_supplycost = min(ps_supplycost)", type="inner")
                hashagg(group="ps_partkey", min(ps_supplycost)="min(ps_supplycost)")
                  exchange(distribution=hash[1], collation=[])
                    project(s_suppkey="s_suppkey", ps_partkey="ps_partkey", ps_suppkey="ps_suppkey", ps_supplycost="ps_supplycost")
                      hashjoin(condition="ps_suppkey = s_suppkey", type="inner")
                        filter(condition="bloomfilter(ps_suppkey)")
                          logicalview(tables="partsupp[p1,p2,p3,p4]", shardcount=4, sql="select `ps_partkey`, `ps_suppkey`, `ps_supplycost` from `partsupp` as `partsupp`")
                        exchange(distribution=broadcast, collation=[])
                          runtimefilterbuilder(condition="runtime_filter_builder_[0](s_suppkey)")
                            logicalview(tables="supplier[p1,p2,p3,p4],nation,region", shardcount=4, sql="select `supplier`.`s_suppkey` from `supplier` as `supplier` inner join `nation` as `nation` on (`supplier`.`s_nationkey` = `nation`.`n_nationkey`) inner join `region` as `region` on ((`nation`.`n_regionkey` = `region`.`r_regionkey`) and (`region`.`r_name` = 'europe'))")
                exchange(distribution=hash[0], collation=[])
                  logicalview(tables="part[p1,p2,p3,p4],partsupp[p1,p2,p3,p4]", shardcount=4, sql="select `part`.`p_partkey`, `part`.`p_mfgr`, `partsupp`.`ps_partkey`, `partsupp`.`ps_suppkey`, `partsupp`.`ps_supplycost` from `part` as `part` inner join `partsupp` as `partsupp` on ((`part`.`p_size` = 15) and (`part`.`p_partkey` = `partsupp`.`ps_partkey`) and (`part`.`p_type` like '%brass')) where (`partsupp`.`ps_partkey` = `part`.`p_partkey`)")

- sql: |
    select
      l_orderkey,
      sum(l_extendedprice*(1-l_discount)) as revenue,
      o_orderdate,
      o_shippriority
    from
      customer,
      orders,
      lineitem
    where
      c_mktsegment = 'BUILDING'
      and c_custkey = o_custkey
      and l_orderkey = o_orderkey
      and o_orderdate < '1995-03-15'
      and l_shipdate > '1995-03-15'
    group by
      l_orderkey,
      o_orderdate,
      o_shippriority
    order by
      revenue desc,
      o_orderdate;

  plan: |

    project(l_orderkey="l_orderkey", revenue="revenue", o_orderdate="o_orderdate", o_shippriority="o_shippriority")
      exchange(distribution=single, collation=[3 desc-nulls-last, 1 asc-nulls-first])
        memsort(sort="revenue desc,o_orderdate asc")
          project(l_orderkey="l_orderkey", o_orderdate="o_orderdate", o_shippriority="o_shippriority", revenue="revenue")
            hashagg(group="o_orderdate,o_shippriority,l_orderkey", revenue="sum(__*__)")
              exchange(distribution=hash[2, 3, 4], collation=[])
                project(c_custkey="c_custkey", o_custkey="o_custkey", o_orderdate="o_orderdate", o_shippriority="o_shippriority", l_orderkey="l_orderkey", __*__="__*__")
                  hashjoin(condition="o_custkey = c_custkey", type="inner")
                    logicalview(tables="orders[p1,p2,p3,p4],lineitem[p1,p2,p3,p4]", shardcount=4, sql="select `orders`.`o_custkey`, `orders`.`o_orderdate`, `orders`.`o_shippriority`, `lineitem`.`l_orderkey`, (`lineitem`.`l_extendedprice` * (1 - `lineitem`.`l_discount`)) as `__*__` from `orders` as `orders` inner join `lineitem` as `lineitem` on ((`orders`.`o_orderkey` = `lineitem`.`l_orderkey`) and (`orders`.`o_orderdate` < '1995-03-15') and (`lineitem`.`l_shipdate` > '1995-03-15'))")
                    exchange(distribution=broadcast, collation=[])
                      logicalview(tables="customer[p1,p2,p3,p4]", shardcount=4, sql="select `c_custkey` from `customer` as `customer` where (`c_mktsegment` = 'building')")

- sql: |
    select o_orderpriority, count(*) as order_count from orders where o_orderdate >= '1993-07-01' and o_orderdate < date_add('1993-07-01', Interval 3 month )
    and exists(
    select
    *
    from
    lineitem
    where
    l_orderkey = o_orderkey
    and l_commitdate < l_receiptdate
    ) group by o_orderpriority order by o_orderpriority;

  plan: |

    exchange(distribution=single, collation=[0 asc-nulls-first])
      memsort(sort="o_orderpriority asc")
        hashagg(group="o_orderpriority", order_count="sum(order_count)")
          exchange(distribution=hash[0], collation=[])
            logicalview(tables="orders[p1,p2,p3,p4],lineitem[p1,p2,p3,p4]", shardcount=4, sql="select `o_orderpriority`, count(*) as `order_count` from `orders` as `orders` where ((`o_orderdate` < date_add('1993-07-01', interval 3 month)) and (`o_orderdate` >= '1993-07-01') and (exists (select `l_orderkey` from `lineitem` as `lineitem` where ((`l_orderkey` = `orders`.`o_orderkey`) and (`l_commitdate` < `l_receiptdate`))))) group by `o_orderpriority`")

- sql: |
    select
    n_name,
    sum(l_extendedprice * (1 - l_discount)) as revenue from
    customer, orders, lineitem, supplier, nation, region
    where
    c_custkey = o_custkey
    and l_orderkey = o_orderkey and l_suppkey = s_suppkey and c_nationkey = s_nationkey and s_nationkey = n_nationkey and n_regionkey = r_regionkey and r_name = 'ASIA'
    and o_orderdate >= '1994-01-01'
    and o_orderdate < date_add(cast('1994-01-01' as date ), Interval 1 year ) group by
    n_name order by
    revenue desc;

  plan: |

    exchange(distribution=single, collation=[1 desc-nulls-last])
      memsort(sort="revenue desc")
        hashagg(group="n_name", revenue="sum(revenue)")
          exchange(distribution=hash[0], collation=[])
            partialhashagg(group="n_name", revenue="sum(__*__)")
              project(s_suppkey="s_suppkey", s_nationkey="s_nationkey", c_custkey="c_custkey", c_nationkey="c_nationkey", n_nationkey="n_nationkey", n_name="n_name", o_custkey="o_custkey", l_suppkey="l_suppkey", __*__="__*__")
                hashjoin(condition="o_custkey = c_custkey and n_nationkey = s_nationkey and s_nationkey = c_nationkey", type="inner")
                  exchange(distribution=hash[2, 1, 1], collation=[])
                    project(s_suppkey="s_suppkey", s_nationkey="s_nationkey", o_custkey="o_custkey", l_suppkey="l_suppkey", __*__="__*__")
                      hashjoin(condition="l_suppkey = s_suppkey", type="inner")
                        logicalview(tables="orders[p1,p2,p3,p4],lineitem[p1,p2,p3,p4]", shardcount=4, sql="select `orders`.`o_custkey`, `lineitem`.`l_suppkey`, (`lineitem`.`l_extendedprice` * (1 - `lineitem`.`l_discount`)) as `__*__` from `orders` as `orders` inner join `lineitem` as `lineitem` on ((`orders`.`o_orderkey` = `lineitem`.`l_orderkey`) and (`orders`.`o_orderdate` >= '1994-01-01') and (`orders`.`o_orderdate` < date_add(cast('1994-01-01' as date), interval 1 year)))")
                        exchange(distribution=broadcast, collation=[])
                          logicalview(tables="supplier[p1,p2,p3,p4]", shardcount=4, sql="select `s_suppkey`, `s_nationkey` from `supplier` as `supplier`")
                  exchange(distribution=hash[0, 2, 1], collation=[])
                    logicalview(tables="customer[p1,p2,p3,p4],nation,region", shardcount=4, sql="select `customer`.`c_custkey`, `customer`.`c_nationkey`, `nation`.`n_nationkey`, `nation`.`n_name` from `customer` as `customer` inner join `nation` as `nation` on (`customer`.`c_nationkey` = `nation`.`n_nationkey`) inner join `region` as `region` on ((`nation`.`n_regionkey` = `region`.`r_regionkey`) and (`region`.`r_name` = 'asia')) where (`nation`.`n_nationkey` = `customer`.`c_nationkey`)")

- sql: |
    select
    sum(l_extendedprice*l_discount) as revenue
    from
    lineitem
    where
    l_shipdate >= '1994-01-01'
    and l_shipdate < date_add(cast('1994-01-01' as date ), Interval 1 year )
    and l_discount between 0.06 - 0.01 and 0.06 + 0.01 and l_quantity < 24;

  plan: |

    hashagg(revenue="sum(revenue)")
      exchange(distribution=single, collation=[])
        logicalview(tables="lineitem[p1,p2,p3,p4]", shardcount=4, sql="select sum((`l_extendedprice` * `l_discount`)) as `revenue` from `lineitem` as `lineitem` where ((`l_discount` between (0.06 - 0.01) and (0.06 + 0.01)) and (`l_shipdate` < date_add(cast('1994-01-01' as date), interval 1 year)) and (`l_quantity` < 24) and (`l_shipdate` >= '1994-01-01'))")

- sql: |
    select
      supp_nation,
      cust_nation,
      l_year,
      sum(volume) as revenue
    from (
      select
        n1.n_name as supp_nation,
        n2.n_name as cust_nation,
        extract(year from l_shipdate) as l_year,
        l_extendedprice * (1 - l_discount) as volume
      from
        supplier,
        lineitem,
        orders,
        customer,
        nation n1,
        nation n2
      where
        s_suppkey = l_suppkey
        and o_orderkey = l_orderkey
        and c_custkey = o_custkey
        and s_nationkey = n1.n_nationkey
        and c_nationkey = n2.n_nationkey
        and (
          (n1.n_name = 'FRANCE'
          and n2.n_name = 'GERMANY')
          or
          (n1.n_name = 'GERMANY'
          and n2.n_name = 'FRANCE')
          )
        and l_shipdate between '1995-01-01' and '1996-12-31' )
        as shipping
    group by
      supp_nation,
      cust_nation,
      l_year
    order by
      supp_nation,
      cust_nation,
      l_year;

  plan: |

    exchange(distribution=single, collation=[0 asc-nulls-first, 1 asc-nulls-first, 2 asc-nulls-first])
      memsort(sort="n_name asc,n_name0 asc,extract asc")
        hashagg(group="n_name,n_name0,extract", revenue="sum(revenue)")
          exchange(distribution=hash[0, 1, 2], collation=[])
            partialhashagg(group="n_name,n_name0,extract", revenue="sum(__*__)")
              project(s_suppkey="s_suppkey", n_name="n_name", n_nationkey0="n_nationkey0", n_name0="n_name0", c_custkey="c_custkey", c_nationkey="c_nationkey", l_suppkey="l_suppkey", o_custkey="o_custkey", extract="extract", __*__="__*__")
                hashjoin(condition="o_custkey = c_custkey and n_nationkey0 = c_nationkey", type="inner")
                  exchange(distribution=hash[0, 1], collation=[])
                    logicalview(tables="customer[p1,p2,p3,p4]", shardcount=4, sql="select `c_custkey`, `c_nationkey` from `customer` as `customer`")
                  exchange(distribution=hash[5, 2], collation=[])
                    project(s_suppkey="s_suppkey", n_name="n_name", n_nationkey0="n_nationkey0", n_name0="n_name0", l_suppkey="l_suppkey", o_custkey="o_custkey", extract="extract", __*__="__*__")
                      hashjoin(condition="l_suppkey = s_suppkey", type="inner")
                        filter(condition="bloomfilter(l_suppkey)")
                          logicalview(tables="lineitem[p1,p2,p3,p4],orders[p1,p2,p3,p4]", shardcount=4, sql="select `lineitem`.`l_suppkey`, `orders`.`o_custkey`, extract(year from `lineitem`.`l_shipdate`) as `extract`, (`lineitem`.`l_extendedprice` * (1 - `lineitem`.`l_discount`)) as `__*__` from `lineitem` as `lineitem` inner join `orders` as `orders` on ((`lineitem`.`l_orderkey` = `orders`.`o_orderkey`) and (`lineitem`.`l_shipdate` between '1995-01-01' and '1996-12-31'))")
                        exchange(distribution=broadcast, collation=[])
                          runtimefilterbuilder(condition="runtime_filter_builder_[0](s_suppkey)")
                            logicalview(tables="supplier[p1,p2,p3,p4],nation,nation", shardcount=4, sql="select `supplier`.`s_suppkey`, `nation`.`n_name`, `nation0`.`n_nationkey` as `n_nationkey0`, `nation0`.`n_name` as `n_name0` from `supplier` as `supplier` inner join `nation` as `nation` on (`supplier`.`s_nationkey` = `nation`.`n_nationkey`) inner join `nation` as `nation0` on (((`nation`.`n_name` = 'france') and (`nation0`.`n_name` = 'germany')) or ((`nation`.`n_name` = 'germany') and (`nation0`.`n_name` = 'france')))")

- sql: |
    select
    o_year,
    sum(case
    when nation = 'BRAZIL'
    then volume
    else 0
    end) / sum(volume) as mkt_share
    from (
    select
    extract(year from o_orderdate) as o_year, l_extendedprice * (1-l_discount) as volume, n2.n_name as nation
    from
    part,
    supplier, lineitem, orders, customer, nation n1, nation n2, region
    where
    p_partkey = l_partkey
    and s_suppkey = l_suppkey
    and l_orderkey = o_orderkey
    and o_custkey = c_custkey
    and c_nationkey = n1.n_nationkey and n1.n_regionkey = r_regionkey and r_name = 'AMERICA'
    and s_nationkey = n2.n_nationkey
    and o_orderdate between '1995-01-01' and '1996-12-31' and p_type = 'ECONOMY ANODIZED STEEL'
    ) as all_nations group by
    o_year order by
    o_year;

  plan: |

    exchange(distribution=single, collation=[0 asc-nulls-first])
      memsort(sort="o_year asc")
        project(o_year="extract", mkt_share="$f1 / $f2")
          hashagg(group="extract", $f1="sum($f1)", $f2="sum($f2)")
            exchange(distribution=hash[0], collation=[])
              partialhashagg(group="extract", $f1="sum(case)", $f2="sum(__*__)")
                project(o_custkey="o_custkey", extract="extract", case="case($8, $6, cast(0):decimal(37, 4) not null)", __*__="__*__", c_custkey="c_custkey")
                  hashjoin(condition="o_custkey = c_custkey", type="inner")
                    exchange(distribution=hash[0], collation=[])
                      logicalview(tables="customer[p1,p2,p3,p4],nation,region", shardcount=4, sql="select `customer`.`c_custkey` from `customer` as `customer` inner join `nation` as `nation` on (`customer`.`c_nationkey` = `nation`.`n_nationkey`) inner join `region` as `region` on ((`nation`.`n_regionkey` = `region`.`r_regionkey`) and (`region`.`r_name` = 'america'))")
                    exchange(distribution=hash[3], collation=[])
                      hashjoin(condition="s_suppkey = l_suppkey", type="inner")
                        exchange(distribution=hash[2], collation=[])
                          project(p_partkey="p_partkey", l_partkey="l_partkey", l_suppkey="l_suppkey", o_custkey="o_custkey", extract="extract", __*__="__*__")
                            hashjoin(condition="p_partkey = l_partkey", type="inner")
                              filter(condition="bloomfilter(l_partkey)")
                                logicalview(tables="lineitem[p1,p2,p3,p4],orders[p1,p2,p3,p4]", shardcount=4, sql="select `lineitem`.`l_partkey`, `lineitem`.`l_suppkey`, `orders`.`o_custkey`, extract(year from `orders`.`o_orderdate`) as `extract`, (`lineitem`.`l_extendedprice` * (1 - `lineitem`.`l_discount`)) as `__*__` from `lineitem` as `lineitem` inner join `orders` as `orders` on ((`lineitem`.`l_orderkey` = `orders`.`o_orderkey`) and (`orders`.`o_orderdate` between '1995-01-01' and '1996-12-31'))")
                              exchange(distribution=broadcast, collation=[])
                                runtimefilterbuilder(condition="runtime_filter_builder_[0](p_partkey)")
                                  logicalview(tables="part[p1,p2,p3,p4]", shardcount=4, sql="select `p_partkey` from `part` as `part` where (`p_type` = 'economy anodized steel')")
                        exchange(distribution=hash[0], collation=[])
                          logicalview(tables="supplier[p1,p2,p3,p4],nation", shardcount=4, sql="select `supplier`.`s_suppkey`, (`nation`.`n_name` = 'brazil') as `=` from `supplier` as `supplier` inner join `nation` as `nation` on (`supplier`.`s_nationkey` = `nation`.`n_nationkey`)")

- sql: |
    select
      nation,
      o_year,
      sum(amount) as sum_profit
    from (
        select
          n_name as nation,
          extract(year from o_orderdate) as o_year,
          l_extendedprice * (1 - l_discount) - ps_supplycost * l_quantity as amount
        from
          part,
          supplier,
          lineitem,
          partsupp,
          orders,
          nation
        where
          s_suppkey = l_suppkey
          and ps_suppkey = l_suppkey
          and ps_partkey = l_partkey
          and p_partkey = l_partkey
          and o_orderkey = l_orderkey
          and s_nationkey = n_nationkey
          and p_name like '%green%'
      ) as profit
    group by
      nation,
      o_year
    order by
      nation,
      o_year desc;

  plan: |

    exchange(distribution=single, collation=[0 asc-nulls-first, 1 desc-nulls-last])
      sortagg(group="nation,o_year", sum_profit="sum(amount)")
        memsort(sort="nation asc,o_year desc")
          exchange(distribution=hash[0, 1], collation=[])
            project(nation="n_name", o_year="extract", amount="__*__ - ps_supplycost * l_quantity")
              hashjoin(condition="ps_partkey = l_partkey and p_partkey = l_partkey and ps_suppkey = l_suppkey and l_suppkey = s_suppkey", type="inner")
                logicalview(tables="lineitem[p1,p2,p3,p4],orders[p1,p2,p3,p4]", shardcount=4, sql="select `lineitem`.`l_partkey`, `lineitem`.`l_suppkey`, `lineitem`.`l_quantity`, extract(year from `orders`.`o_orderdate`) as `extract`, (`lineitem`.`l_extendedprice` * (1 - `lineitem`.`l_discount`)) as `__*__` from `lineitem` as `lineitem` inner join `orders` as `orders` on (`lineitem`.`l_orderkey` = `orders`.`o_orderkey`)")
                project(s_suppkey="s_suppkey", n_name="n_name", p_partkey="p_partkey", ps_partkey="ps_partkey", ps_suppkey="ps_suppkey", ps_supplycost="ps_supplycost")
                  exchange(distribution=broadcast, collation=[])
                    hashjoin(condition="ps_suppkey = s_suppkey", type="inner")
                      exchange(distribution=hash[2], collation=[])
                        logicalview(tables="part[p1,p2,p3,p4],partsupp[p1,p2,p3,p4]", shardcount=4, sql="select `part`.`p_partkey`, `partsupp`.`ps_partkey`, `partsupp`.`ps_suppkey`, `partsupp`.`ps_supplycost` from `part` as `part` inner join `partsupp` as `partsupp` on ((`part`.`p_partkey` = `partsupp`.`ps_partkey`) and (`part`.`p_name` like '%green%')) where (`part`.`p_partkey` = `partsupp`.`ps_partkey`)")
                      exchange(distribution=hash[0], collation=[])
                        logicalview(tables="supplier[p1,p2,p3,p4],nation", shardcount=4, sql="select `supplier`.`s_suppkey`, `nation`.`n_name` from `supplier` as `supplier` inner join `nation` as `nation` on (`supplier`.`s_nationkey` = `nation`.`n_nationkey`)")

- sql: |
    select * from (select
      ps_partkey,
      sum(ps_supplycost * ps_availqty) as value
    from
      partsupp,
      supplier,
      nation
    where
      ps_suppkey = s_suppkey
      and s_nationkey = n_nationkey
      and n_name = 'GERMANY'
    group by
      ps_partkey
      )
    where
      value > (
        select
          sum(ps_supplycost * ps_availqty) * 0.0001
        from
          partsupp,
          supplier,
          nation
        where
          ps_suppkey = s_suppkey
          and s_nationkey = n_nationkey and n_name = 'GERMANY'
      )
    order by
      value desc;

  plan: |

    exchange(distribution=single, collation=[1 desc-nulls-last])
      memsort(sort="value desc")
        project(ps_partkey="ps_partkey", value="value")
          nljoin(condition="value > $f0 * 0.0001", type="inner")
            hashagg(group="ps_partkey", value="sum(__*__)")
              exchange(distribution=hash[1], collation=[])
                bkajoin(condition="ps_suppkey = s_suppkey", type="inner")
                  logicalview(tables="supplier[p1,p2,p3,p4],nation", shardcount=4, sql="select `supplier`.`s_suppkey` from `supplier` as `supplier` inner join `nation` as `nation` on ((`supplier`.`s_nationkey` = `nation`.`n_nationkey`) and (`nation`.`n_name` = 'germany'))")
                  logicalview(tables="partsupp[p1,p2,p3,p4]", shardcount=4, sql="select `ps_partkey`, `ps_suppkey`, (`ps_supplycost` * `ps_availqty`) as `__*__` from `partsupp` as `partsupp` force index(`idx_partsupp_suppkey`) where (`ps_suppkey` in (...))")
            exchange(distribution=broadcast, collation=[])
              hashagg($f0="sum($f0)")
                exchange(distribution=single, collation=[])
                  partialhashagg($f0="sum(__*__)")
                    bkajoin(condition="ps_suppkey = s_suppkey", type="inner")
                      logicalview(tables="supplier[p1,p2,p3,p4],nation", shardcount=4, sql="select `supplier`.`s_suppkey` from `supplier` as `supplier` inner join `nation` as `nation` on ((`supplier`.`s_nationkey` = `nation`.`n_nationkey`) and (`nation`.`n_name` = 'germany'))")
                      logicalview(tables="partsupp[p1,p2,p3,p4]", shardcount=4, sql="select `ps_suppkey`, (`ps_supplycost` * `ps_availqty`) as `__*__` from `partsupp` as `partsupp` force index(`idx_partsupp_suppkey`) where (`ps_suppkey` in (...))")

- sql: |
    select
    l_shipmode,
    sum(case
    when o_orderpriority ='1-URGENT'
    or o_orderpriority ='2-HIGH' then 1
    else 0
    end) as high_line_count,
    sum(case
    when o_orderpriority <> '1-URGENT'
    and o_orderpriority <> '2-HIGH' then 1
    else 0
    end) as low_line_count
    from
    orders,
    lineitem where
    o_orderkey = l_orderkey
    and l_shipmode in ('MAIL', 'SHIP') and l_commitdate < l_receiptdate
    and l_shipdate < l_commitdate
    and l_receiptdate >= '1994-01-01'
    and l_receiptdate < date_add(cast('1994-01-01' as date ), Interval 1 year )
    group by l_shipmode
    order by l_shipmode;
  plan: |

    exchange(distribution=single, collation=[0 asc-nulls-first])
      sortagg(group="l_shipmode", high_line_count="sum(high_line_count)", low_line_count="sum(low_line_count)")
        exchange(distribution=hash[0], collation=[0 asc-nulls-first])
          logicalview(tables="orders[p1,p2,p3,p4],lineitem[p1,p2,p3,p4]", shardcount=4, sql="select `lineitem`.`l_shipmode`, sum((case when ((`orders`.`o_orderpriority` = '1-urgent') or (`orders`.`o_orderpriority` = '2-high')) then 1 else 0 end)) as `high_line_count`, sum((case when ((`orders`.`o_orderpriority` <> '1-urgent') and (`orders`.`o_orderpriority` <> '2-high')) then 1 else 0 end)) as `low_line_count` from `orders` as `orders` inner join `lineitem` as `lineitem` on ((`orders`.`o_orderkey` = `lineitem`.`l_orderkey`) and (`lineitem`.`l_shipmode` in('mail', 'ship')) and (`lineitem`.`l_commitdate` < `lineitem`.`l_receiptdate`) and (`lineitem`.`l_shipdate` < `lineitem`.`l_commitdate`) and (`lineitem`.`l_receiptdate` >= '1994-01-01') and (`lineitem`.`l_receiptdate` < date_add(cast('1994-01-01' as date), interval 1 year))) group by `lineitem`.`l_shipmode` order by `lineitem`.`l_shipmode`")

- sql: |
    select
    c_count, count(*) as custdist
    from (

    select
    c_custkey,
    count(o_orderkey) as c_count from
    customer left outer join orders on c_custkey = o_custkey
    and o_comment not like '%special%requests%'
    group by c_custkey

    )as c_orders group by
    c_count order by
    custdist desc, c_count desc;

  plan: |

    exchange(distribution=single, collation=[1 desc-nulls-last, 0 desc-nulls-last])
      memsort(sort="custdist desc,c_count desc")
        hashagg(group="c_count", custdist="count()")
          exchange(distribution=hash[1], collation=[])
            hashgroupjoin(condition="c_custkey = o_custkey", type="left")
              exchange(distribution=hash[0], collation=[])
                logicalview(tables="customer[p1,p2,p3,p4]", shardcount=4, sql="select `c_custkey` from `customer` as `customer`")
              exchange(distribution=hash[1], collation=[])
                logicalview(tables="orders[p1,p2,p3,p4]", shardcount=4, sql="select `o_orderkey`, `o_custkey` from `orders` as `orders` where (`o_comment` not like '%special%requests%')")

- sql: |
    select
      100.00 * sum(
      case when p_type like 'PROMO%'
         then l_extendedprice*(1-l_discount)
         else 0 end) /
         sum(l_extendedprice * (1 - l_discount)) as promo_revenue
    from
      lineitem,
      part
    where
      l_partkey = p_partkey
      and l_shipdate >= '1995-09-01'
      and l_shipdate < date_add(cast('1995-09-01' as date ), Interval 1 year );

  plan: |

    project(promo_revenue="100.00 * $f0 / $f1")
      hashagg($f0="sum($f0)", $f1="sum($f1)")
        exchange(distribution=single, collation=[])
          partialhashagg($f0="sum($f0)", $f1="sum($f1)")
            project($f0="case($3, $1, cast(0):decimal(37, 4) not null)", $f1="__*__")
              hashjoin(condition="l_partkey = p_partkey", type="inner")
                exchange(distribution=hash[0], collation=[])
                  logicalview(tables="lineitem[p1,p2,p3,p4]", shardcount=4, sql="select `l_partkey`, (`l_extendedprice` * (1 - `l_discount`)) as `__*__` from `lineitem` as `lineitem` where ((`l_shipdate` >= '1995-09-01') and (`l_shipdate` < date_add(cast('1995-09-01' as date), interval 1 year)))")
                exchange(distribution=hash[0], collation=[])
                  logicalview(tables="part[p1,p2,p3,p4]", shardcount=4, sql="select `p_partkey`, (`p_type` like 'promo%') as `like` from `part` as `part`")

- sql: |
    select
    s_suppkey,
    s_name, s_address, s_phone, total_revenue
    from
    supplier,
    (select
    l_suppkey as supplier_no,
    sum(l_extendedprice * (1 - l_discount)) as total_revenue
     from
    lineitem where
    l_shipdate >= '1996-01-01'
    and l_shipdate <  date_add('1996-01-01', Interval 3 month )

    group by
    l_suppkey) as a

    where
    s_suppkey = supplier_no and total_revenue = (

    select
    max(total_revenue)
    from
    (select
    l_suppkey as supplier_no,
    sum(l_extendedprice * (1 - l_discount)) as total_revenue
     from
    lineitem where
    l_shipdate >= '1996-01-01'
    and l_shipdate <  date_add(cast('1996-01-01' as date ), Interval 3 month )

    group by
    l_suppkey) as b
    )
    order by
    s_suppkey;

  plan: |

    project(s_suppkey="s_suppkey", s_name="s_name", s_address="s_address", s_phone="s_phone", total_revenue="total_revenue")
      exchange(distribution=single, collation=[0 asc-nulls-first])
        hashjoin(condition="supplier_no = s_suppkey", type="inner")
          exchange(distribution=hash[0], collation=[0 asc-nulls-first])
            logicalview(tables="supplier[p1,p2,p3,p4]", shardcount=4, sql="select `s_suppkey`, `s_name`, `s_address`, `s_phone` from `supplier` as `supplier` force index(`primary`) order by `s_suppkey`")
          project(max(total_revenue)="max(total_revenue)", supplier_no="supplier_no", total_revenue="total_revenue")
            hashjoin(condition="max(total_revenue) = total_revenue", type="inner")
              filter(condition="bloomfilter(total_revenue)")
                hashagg(group="supplier_no", total_revenue="sum(total_revenue)")
                  exchange(distribution=hash[0], collation=[])
                    logicalview(tables="lineitem[p1,p2,p3,p4]", shardcount=4, sql="select `l_suppkey` as `supplier_no`, sum((`l_extendedprice` * (1 - `l_discount`))) as `total_revenue` from `lineitem` as `lineitem` where ((`l_shipdate` >= '1996-01-01') and (`l_shipdate` < date_add('1996-01-01', interval 3 month))) group by `l_suppkey`")
              exchange(distribution=broadcast, collation=[])
                runtimefilterbuilder(condition="runtime_filter_builder_[0](max(total_revenue))")
                  hashagg(max(total_revenue)="max(max(total_revenue))")
                    exchange(distribution=single, collation=[])
                      partialhashagg(max(total_revenue)="max(total_revenue)")
                        hashagg(group="supplier_no", total_revenue="sum(total_revenue)")
                          exchange(distribution=hash[0], collation=[])
                            logicalview(tables="lineitem[p1,p2,p3,p4]", shardcount=4, sql="select `l_suppkey` as `supplier_no`, sum((`l_extendedprice` * (1 - `l_discount`))) as `total_revenue` from `lineitem` as `lineitem` where ((`l_shipdate` >= '1996-01-01') and (`l_shipdate` < date_add(cast('1996-01-01' as date), interval 3 month))) group by `l_suppkey`")

- sql: |
    select
      p_brand,
      p_type,
      p_size,
      count(distinct ps_suppkey) as supplier_cnt
    from
      partsupp,
      part
    where
      p_partkey = ps_partkey
      and p_brand <> 'Brand#45'
      and p_type not like 'MEDIUM POLISHED'
      and p_size in (49, 14, 23, 45, 19, 3, 36, 9)
      and ps_suppkey not in (
        select
          s_suppkey
        from
          supplier
        where
          s_comment like '%Customer%Complaints%'
        )
    group by
      p_brand,
      p_type,
      p_size
    order by
      supplier_cnt desc,
      p_brand,
      p_type,
      p_size;

  plan: |
    exchange(distribution=single, collation=[3 desc-nulls-last, 0 asc-nulls-first, 1 asc-nulls-first, 2 asc-nulls-first])
      memsort(sort="supplier_cnt desc,p_brand asc,p_type asc,p_size asc")
        hashagg(group="p_brand,p_type,p_size", supplier_cnt="count(ps_suppkey)")
          hashagg(group="p_brand,p_type,p_size,ps_suppkey")
            exchange(distribution=hash[1], collation=[])
              project(p_brand="p_brand", p_type="p_type", p_size="p_size", ps_suppkey="ps_suppkey")
                semihashjoin(condition="ps_suppkey = s_suppkey", type="anti", build="inner")
                  logicalview(tables="partsupp[p1,p2,p3,p4],part[p1,p2,p3,p4]", shardcount=4, sql="select `partsupp`.`ps_suppkey`, `part`.`p_brand`, `part`.`p_type`, `part`.`p_size` from `partsupp` as `partsupp` inner join `part` as `part` on ((`partsupp`.`ps_partkey` = `part`.`p_partkey`) and (`part`.`p_brand` <> 'brand#45') and (`part`.`p_type` not like 'medium polished') and (`part`.`p_size` in(49, 14, 23, 45, 19, 3, 36, 9)))")
                  exchange(distribution=broadcast, collation=[])
                    logicalview(tables="supplier[p1,p2,p3,p4]", shardcount=4, sql="select `s_suppkey` from `supplier` as `supplier` where (`s_comment` like '%customer%complaints%')")

- sql: |
    select
      sum(l_extendedprice) / 7.0 as avg_yearly
    from
      lineitem,
      part
    where
      p_partkey = l_partkey
      and p_brand = 'Brand#23'
      and p_container = 'MED BOX'
      and l_quantity < (
        select
          0.2 * avg(l_quantity)
        from
          lineitem
        where
          l_partkey = p_partkey
      );

  plan: |

    project(avg_yearly="$f0 / 7.0")
      hashagg($f0="sum($f0)")
        exchange(distribution=single, collation=[])
          partialhashagg($f0="sum(l_extendedprice)")
            filter(condition="l_quantity < 0.2 * f16w0$o0")
              hashwindow(p_partkey="p_partkey", l_partkey="l_partkey", l_quantity="l_quantity", l_extendedprice="l_extendedprice", f4w0$o0="window#0avg($2)", reference windows="window#0=window(partition {1} order by [] range between unbounded preceding and unbounded following aggs [avg($2)])")
                exchange(distribution=hash[1], collation=[])
                  bkajoin(condition="l_partkey = p_partkey", type="inner")
                    logicalview(tables="part[p1,p2,p3,p4]", shardcount=4, sql="select `p_partkey` from `part` as `part` where ((`p_container` = 'med box') and (`p_brand` = 'brand#23'))")
                    logicalview(tables="lineitem[p1,p2,p3,p4]", shardcount=4, sql="select `l_partkey`, `l_quantity`, `l_extendedprice` from `lineitem` as `lineitem` force index(`i_l_partkey`) where (`l_partkey` in (...))")

- sql: |
    select
    sum(l_extendedprice * (1 - l_discount) ) as revenue
    from
    lineitem,
    part where
    (

    p_partkey = l_partkey
    and p_brand = 'Brand#12'
    and p_container in ( 'SM CASE', 'SM BOX', 'SM PACK', 'SM PKG') and l_quantity >= 1 and l_quantity <= 1 + 10 and p_size between 1 and 5
    and l_shipmode in ('AIR', 'AIR REG')
    and l_shipinstruct = 'DELIVER IN PERSON'

    ) or (

    p_partkey = l_partkey
    and p_brand = 'Brand#23'
    and p_container in ('MED BAG', 'MED BOX', 'MED PKG', 'MED PACK') and l_quantity >= 10 and l_quantity <= 20 + 10 and p_size between 1 and 10
    and l_shipmode in ('AIR', 'AIR REG')
    and l_shipinstruct = 'DELIVER IN PERSON'

    ) or
    (

    p_partkey = l_partkey
    and p_brand = 'Brand#34'
    and p_container in ( 'LG CASE', 'LG BOX', 'LG PACK', 'LG PKG') and l_quantity >= 20 and l_quantity <= 20 + 10 and p_size between 1 and 15
    and l_shipmode in ('AIR', 'AIR REG')
    and l_shipinstruct = 'DELIVER IN PERSON'

    );

  plan: |

    hashagg(revenue="sum(revenue)")
      exchange(distribution=single, collation=[])
        partialhashagg(revenue="sum(__*__)")
          bkajoin(condition="p_partkey = l_partkey and ((p_partkey = l_partkey and = and in and >= and <= and between asymmetric and in and =) or (p_partkey = l_partkey and =4 and in5 and >=6 and <=7 and between asymmetric6 and in and =) or (p_partkey = l_partkey and =7 and in8 and >=8 and <=7 and between asymmetric9 and in and =))", type="inner")
            logicalview(tables="part[p1,p2,p3,p4]", shardcount=4, sql="select `p_partkey`, (`p_brand` = 'brand#12') as `=`, (`p_container` in('sm case', 'sm box', 'sm pack', 'sm pkg')) as `in`, (`p_size` between 1 and 5) as `between asymmetric`, (`p_brand` = 'brand#23') as `=4`, (`p_container` in('med bag', 'med box', 'med pkg', 'med pack')) as `in5`, (`p_size` between 1 and 10) as `between asymmetric6`, (`p_brand` = 'brand#34') as `=7`, (`p_container` in('lg case', 'lg box', 'lg pack', 'lg pkg')) as `in8`, (`p_size` between 1 and 15) as `between asymmetric9` from `part` as `part` where (((`p_brand` = 'brand#12') and (`p_container` in('sm case', 'sm box', 'sm pack', 'sm pkg')) and (`p_size` between 1 and 5)) or ((`p_brand` = 'brand#23') and (`p_container` in('med bag', 'med box', 'med pkg', 'med pack')) and (`p_size` between 1 and 10)) or ((`p_brand` = 'brand#34') and (`p_container` in('lg case', 'lg box', 'lg pack', 'lg pkg')) and (`p_size` between 1 and 15)))")
            logicalview(tables="lineitem[p1,p2,p3,p4]", shardcount=4, sql="select `l_partkey`, (`l_extendedprice` * (1 - `l_discount`)) as `__*__`, (`l_quantity` >= 1) as `>=`, (`l_quantity` <= (1 + 10)) as `<=`, (`l_shipmode` in('air', 'air reg')) as `in`, (`l_shipinstruct` = 'deliver in person') as `=`, (`l_quantity` >= 10) as `>=6`, (`l_quantity` <= (20 + 10)) as `<=7`, (`l_quantity` >= 20) as `>=8` from `lineitem` as `lineitem` where ((((`l_quantity` >= 1) and (`l_quantity` <= (1 + 10)) and (`l_shipmode` in('air', 'air reg')) and (`l_shipinstruct` = 'deliver in person')) or ((`l_quantity` >= 10) and (`l_quantity` <= (20 + 10)) and (`l_shipmode` in('air', 'air reg')) and (`l_shipinstruct` = 'deliver in person')) or ((`l_quantity` >= 20) and (`l_quantity` <= (20 + 10)) and (`l_shipmode` in('air', 'air reg')) and (`l_shipinstruct` = 'deliver in person'))) and (`l_partkey` in (...)))")

- sql: |
    select
      s_name,
      s_address
    from
      supplier,
      nation
    where
      s_suppkey
      in (
        select
          ps_suppkey
        from
          partsupp
        where
          ps_partkey
          in (
            select
              p_partkey
            from
              part
            where
              p_name like 'forest%'
          )
          and ps_availqty > (
            select
              0.5 * sum(l_quantity)
            from
              lineitem
            where
              l_partkey = ps_partkey
              and l_suppkey = ps_suppkey
              and l_shipdate >= '1994-01-01'
              and l_shipdate < date_add(cast('1994-01-01' as date ), Interval 1 year )
            )
      )
      and s_nationkey = n_nationkey
      and n_name = 'CANADA'
    order by
      s_name;

  plan: |

    exchange(distribution=single, collation=[0 asc-nulls-first])
      memsort(sort="s_name asc")
        project(s_name="s_name", s_address="s_address")
          semihashjoin(condition="s_suppkey = ps_suppkey", type="semi", build="inner")
            logicalview(tables="supplier[p1,p2,p3,p4],nation", shardcount=4, sql="select `supplier`.`s_suppkey`, `supplier`.`s_name`, `supplier`.`s_address` from `supplier` as `supplier` inner join `nation` as `nation` on ((`supplier`.`s_nationkey` = `nation`.`n_nationkey`) and (`nation`.`n_name` = 'canada'))")
            exchange(distribution=broadcast, collation=[])
              project(ps_suppkey="ps_suppkey")
                hashjoin(condition="l_partkey = ps_partkey and l_suppkey = ps_suppkey and ps_availqty > 0.5 * $f2", type="inner")
                  hashagg(group="l_partkey,l_suppkey", $f2="sum($f2)")
                    exchange(distribution=hash[0, 1], collation=[])
                      filter(condition="bloomfilter(l_partkey) and bloomfilter(l_suppkey)")
                        logicalview(tables="lineitem[p1,p2,p3,p4]", shardcount=4, sql="select `l_partkey`, `l_suppkey`, sum(`l_quantity`) as `$f2` from `lineitem` as `lineitem` where ((`l_shipdate` < date_add(cast('1994-01-01' as date), interval 1 year)) and (`l_shipdate` >= '1994-01-01')) group by `l_partkey`, `l_suppkey`")
                  exchange(distribution=hash[0, 1], collation=[])
                    runtimefilterbuilder(condition="runtime_filter_builder_[0](ps_partkey) and runtime_filter_builder_[1](ps_suppkey)")
                      logicalview(tables="partsupp[p1,p2,p3,p4],part[p1,p2,p3,p4]", shardcount=4, sql="select `ps_partkey`, `ps_suppkey`, `ps_availqty` from `partsupp` as `partsupp` where (`ps_partkey` in (select `p_partkey` from `part` as `part` where ((`p_name` like 'forest%') and (`partsupp`.`ps_partkey` = `p_partkey`))))")

- sql: |
    select
      s_name,
      count(*) as numwait
    from
      supplier,
      lineitem l1,
      orders,
      nation
    where
      s_suppkey = l1.l_suppkey
      and o_orderkey = l1.l_orderkey
      and o_orderstatus = 'F'
      and l1.l_receiptdate > l1.l_commitdate
      and exists (
          select
            *
          from
            lineitem l2
          where
            l2.l_orderkey = l1.l_orderkey
            and l2.l_suppkey <> l1.l_suppkey
          )
      and not exists (
          select
            *
          from
            lineitem l3
          where
            l3.l_orderkey = l1.l_orderkey
            and l3.l_suppkey <> l1.l_suppkey
            and l3.l_receiptdate > l3.l_commitdate
          )
      and s_nationkey = n_nationkey
      and n_name = 'SAUDI ARABIA'
    group by
      s_name
    order by
      numwait desc,
      s_name;

  plan: |

    exchange(distribution=single, collation=[1 desc-nulls-last, 0 asc-nulls-first])
      memsort(sort="numwait desc,s_name asc")
        hashagg(group="s_name", numwait="count()")
          exchange(distribution=hash[1], collation=[])
            semibkajoin(condition="l_orderkey = l_orderkey and l_suppkey <> l_suppkey", type="semi")
              project(s_suppkey="s_suppkey", s_name="s_name", l_orderkey="l_orderkey", l_suppkey="l_suppkey")
                hashjoin(condition="l_suppkey = s_suppkey", type="inner")
                  filter(condition="bloomfilter(l_suppkey)")
                    logicalview(tables="lineitem[p1,p2,p3,p4],orders[p1,p2,p3,p4],lineitem[p1,p2,p3,p4]", shardcount=4, sql="select `lineitem`.`l_orderkey`, `lineitem`.`l_suppkey` from `lineitem` as `lineitem` inner join `orders` as `orders` on ((`lineitem`.`l_orderkey` = `orders`.`o_orderkey`) and (`orders`.`o_orderstatus` = 'f') and (`lineitem`.`l_receiptdate` > `lineitem`.`l_commitdate`)) where (not exists (select `l_orderkey` from `lineitem` as `lineitem0` where ((`l_receiptdate` > `l_commitdate`) and (`l_orderkey` = `lineitem`.`l_orderkey`) and (`l_suppkey` <> `lineitem`.`l_suppkey`))))")
                  exchange(distribution=broadcast, collation=[])
                    runtimefilterbuilder(condition="runtime_filter_builder_[0](s_suppkey)")
                      logicalview(tables="supplier[p1,p2,p3,p4],nation", shardcount=4, sql="select `supplier`.`s_suppkey`, `supplier`.`s_name` from `supplier` as `supplier` inner join `nation` as `nation` on ((`supplier`.`s_nationkey` = `nation`.`n_nationkey`) and (`nation`.`n_name` = 'saudi arabia'))")
              logicalview(tables="lineitem[p1,p2,p3,p4]", shardcount=4, sql="select `l_orderkey`, `l_suppkey` from `lineitem` as `lineitem` force index(`primary`) where (`l_orderkey` in (...))")

- sql: |
    /*+TDDL:ENABLE_RUNTIME_FILTER=false */
    select x.tt from customer join (select sum(o_custkey)+1 as tt from orders group by o_orderkey) x on c_nationkey > x.tt;

  plan: |

    project(tt="$f1 + 1")
      nljoin(condition="c_nationkey > $f1 + 1", type="inner")
        exchange(distribution=single, collation=[])
          logicalview(tables="orders[p1,p2,p3,p4]", shardcount=4, sql="select `o_orderkey`, sum(`o_custkey`) as `$f1` from `orders` as `orders` group by `o_orderkey`")
        exchange(distribution=single, collation=[])
          logicalview(tables="customer[p1,p2,p3,p4]", shardcount=4, sql="select `c_nationkey` from `customer` as `customer`")

- sql: |
    /*+TDDL:ENABLE_RUNTIME_FILTER=false */
    select x.tt from customer join (select sum(o_custkey)+1 as tt from orders group by o_orderkey) x on c_nationkey = x.tt;

  plan: |

    project(tt="tt")
      hashjoin(condition="tt = c_nationkey", type="inner")
        exchange(distribution=hash[0], collation=[])
          logicalview(tables="orders[p1,p2,p3,p4]", shardcount=4, sql="select (sum(`o_custkey`) + 1) as `tt` from `orders` as `orders` group by `o_orderkey`")
        project(c_nationkey="c_nationkey")
          exchange(distribution=hash[1], collation=[])
            project(c_nationkey="c_nationkey", c_nationkey_shuffle__="cast(c_nationkey)")
              logicalview(tables="customer[p1,p2,p3,p4]", shardcount=4, sql="select `c_nationkey` from `customer` as `customer`")
